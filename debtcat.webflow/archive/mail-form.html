<!DOCTYPE html><!--  Last Published: Thu Feb 06 2025 20:19:31 GMT+0000 (Coordinated Universal Time)  -->
<html data-wf-page="6677b7b0352800c9b74ceb19" data-wf-site="66567a3f3727972f31237c21">
<head>
  <meta charset="utf-8">
  <title>Mail Form</title>
  <meta content="Mail Form" property="og:title">
  <meta content="Mail Form" property="twitter:title">
  <meta content="width=device-width, initial-scale=1" name="viewport">
  <meta content="6e09m7Tfl6u4e-eTXMXpwCbUlW_YC8oVpyv0EL-XU9k" name="google-site-verification">
  <meta content="noindex" name="robots">
  <link href="../css/normalize.css" rel="stylesheet" type="text/css">
  <link href="../css/webflow.css" rel="stylesheet" type="text/css">
  <link href="../css/debtcat.webflow.css" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com" rel="preconnect">
  <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin="anonymous">
  <script src="https://ajax.googleapis.com/ajax/libs/webfont/1.6.26/webfont.js" type="text/javascript"></script>
  <script type="text/javascript">WebFont.load({  google: {    families: ["Montserrat:100,100italic,200,200italic,300,300italic,400,400italic,500,500italic,600,600italic,700,700italic,800,800italic,900,900italic","Merriweather:300,300italic,400,400italic,700,700italic,900,900italic","Roboto:100,300,regular,500,700,900"]  }});</script>
  <script type="text/javascript">!function(o,c){var n=c.documentElement,t=" w-mod-";n.className+=t+"js",("ontouchstart"in o||o.DocumentTouch&&c instanceof DocumentTouch)&&(n.className+=t+"touch")}(window,document);</script>
  <link href="../images/favicon.png" rel="shortcut icon" type="image/x-icon">
  <link href="../images/webclip.png" rel="apple-touch-icon">
  <script async="" src="https://www.googletagmanager.com/gtag/js?id=G-DMRMQNLTBZ"></script>
  <script type="text/javascript">window.dataLayer = window.dataLayer || [];function gtag(){dataLayer.push(arguments);}gtag('js', new Date());gtag('set', 'developer_id.dZGVlNj', true);gtag('config', 'G-DMRMQNLTBZ');</script><!--  Google tag (gtag.js) ** MOVED to site settings/integrations"
<script async src="https://www.googletagmanager.com/gtag/js?id=G-DMRMQNLTBZ"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-DMRMQNLTBZ');
</script>   -->
  <!--   MS Clarity   -->
  <script type="text/javascript">
    (function(c,l,a,r,i,t,y){
        c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)};
        t=l.createElement(r);t.async=1;t.src="https://www.clarity.ms/tag/"+i;
        y=l.getElementsByTagName(r)[0];y.parentNode.insertBefore(t,y);
    })(window, document, "clarity", "script", "oc17kv2js6");
</script>
  <script>
  // Define the getIP function before loading the ipify script
  function getIP(json) {
    userIP = json.ip;
  }
  // Initialize the userIP variable
  let userIP = '';
</script>
  <script src="https://api.ipify.org?format=jsonp&callback=getIP"></script>
  <link rel="stylesheet" href="https://unpkg.com/@geoapify/geocoder-autocomplete@^1/styles/minimal.css">
</head>
<body>
  <section></section>
  <div class="w-embed w-script">
    <!DOCTYPE html>
    <html lang="en">
    <head>
      <meta charset="UTF-8">
      <title>Mail Form with Editable Confirmation Modal</title>
      <style>
    /* Stylesheet */
    @import url('https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&display=swap');
    body {
      display: flex;
      justify-content: center; 
      align-items: center;
      min-height: 100vh;
      background-color: #f0f0f0;
      font-family: 'Montserrat', Arial, sans-serif;
      margin: 0;
      padding: 20px;
      box-sizing: border-box;
    }
    .container {
      text-align: center;
      background-color: #ffffff;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
      width: 100%;
      max-width: 500px;
      box-sizing: border-box;
    }
    .form-section {
      margin-bottom: 15px;
      text-align: left;
    }
    label {
      margin-top: 5px;
      display: block;
      font-weight: bold;
    }
    input, select {
      margin: 3px 0;
      padding: 8px;
      border: 1px solid #ccc;
      border-radius: 4px;
      width: 100%;
      box-sizing: border-box;
    }
    button {
      margin-top: 16px;
      padding: 12px 24px;
      background-color: #CEFF4B; /* Kiwi green */
      color: #000;
      border: 3px solid #000; /* Border all around */
      border-right-width: 5px; /* Heavier right border */
      border-bottom-width: 5px; /* Heavier bottom border */
      border-radius: 8px;
      box-shadow: 3px 3px 0px 0px #000; /* Solid shadow, slightly offset */
      cursor: pointer;
      font-family: 'Roboto', sans-serif;
      font-weight: 700;
      font-size: 16px;
      width: 100%;
      max-width: 350px;
      display: block;
      margin-left: auto;
      margin-right: auto;
    }
    button:hover {
      background-color: #B4DC40; /* Lighter green hover */
      box-shadow: 3px 3px 0px 0px #000; /* Keep the solid shadow */
    }
    button:active {
      background-color: #A4C930; /* Darker green when clicked */
      transform: translateY(2px);
    }
    button:disabled {
      background-color: #e0e0e0; /* Grey background */
      border: 3px solid #ccc; /* Lighter border */
      color: #999; /* Light grey text */
      cursor: not-allowed;
    }
    #errorMessage {
      margin-top: 15px;
      color: #DA0F0F;
      display: none;
    }
    #successMessage {
      margin-top: 15px;
      color: #28a745;
      display: none;
    }
    .autocomplete-items {
      position: absolute;
      border: 1px solid rgba(0, 0, 0, 0.1);
      box-shadow: 0px 2px 10px 2px rgba(0, 0, 0, 0.1);
      border-top: none;
      background-color: #fff;
      z-index: 99;
      top: calc(100% + 2px);
      left: 0;
      right: 0;
    }
    .autocomplete-items div {
      padding: 10px;
      cursor: pointer;
      display: flex;
      justify-content: space-between;
    }
    .autocomplete-items div:hover {
      background-color: rgba(0, 0, 0, 0.1);
    }
    .autocomplete-items div .dismiss {
      position: absolute;
      top: 5px;
      right: 10px;
      cursor: pointer;
      color: black;
      font-weight: bold;
      font-size: 18px;
    }
    .opt-in-container {
      display: flex;
      align-items: center;
      margin-top: 15px;
    }
    .opt-in-container input[type="checkbox"] {
      width: 20px;
      height: 20px;
      margin-right: 10px;
    }
    .opt-in-container a {
      text-decoration: underline;
      color: blue;
    }
    #confirmationModal {
      display: none;
      position: fixed;
      justify-content: center;
      align-items: center;
      z-index: 1000;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      overflow: auto;
      background-color: rgb(255, 255, 255, 0.9);
      padding-top: 40px;
    }
    #confirmationModalContent {
      background-color: rgba(255, 255, 255);
      padding: 20px;
      border: 1px solid #ddd;
      width: 90%;
      max-width: 520px;
      max-height: 80vh; 
      overflow-y: auto;
      border-radius: 8px;
      box-shadow: 0px 4px 15px rgba(0, 0, 0, 0.1);
      position: relative;
      margin: 0 auto;
    }
    .close {
      color: #aaa;
      position: absolute;
      top: 15px;
      right: 15px;
      font-size: 28px;
      font-weight: bold;
      cursor: pointer;
    }
    .close:hover,
    .close:focus {
      color: black;
      text-decoration: none;
    }
    .info-card {
      margin-bottom: 16px;
      padding: 15px;
      border: none;
      border-radius: 8px;
      background-color: #f9f9f9;
      position: relative;
    }
    .info-card h3 {
      margin-top: 0;
      font-weight: 600;
    }
    .review-label {
      font-family: 'Roboto', sans-serif;
      font-weight: 600;
      font-size: 16px;
      margin-bottom: 5px;
      display: block;
    }
    .review-value {
      font-family: 'Roboto', sans-serif;
      font-weight: 400;
      font-size: 16px;
      margin-bottom: 20px;
      display: block;
      word-wrap: break-word;
      white-space: normal;
    }
    .review-input, .review-select {
      width: 100%;
      padding: 8px;
      margin-bottom: 15px;
      border: 1px solid #ccc;
      border-radius: 4px;
      font-size: 16px;
      box-sizing: border-box;
    }
    .field-group {
      margin-bottom: 10px;
    }
    .edit-button {
      background-color: #fff; 
      border: 3px solid #1A1A1E; 
      border-right-width: 5px; 
      border-bottom-width: 5px; 
      color: #1A1A1E; 
      font-family: 'Roboto', sans-serif;
      font-size: 14px;
      font-weight: 700;
      padding: 8px 20px; 
      cursor: pointer;
      margin-bottom: 10px;
      display: inline-block;
      width: auto; 
      text-align: center;
      position: absolute;
      right: 15px;
      top: -8px; 
      box-shadow: none; 
    }
    .edit-button:hover {
      background-color: #f0f0f0;
    }
    /* For narrow screens */
    @media screen and (max-width: 600px) {
      .edit-button {
        position: static;
        width: 100%; /* Full width on small screens */
        display: block;
        margin-top: 10px;
      }
    }
    .section-header {
      position: relative;
      margin-bottom: 20px;
    }
    .section-header h3 {
      margin: 0;
      margin-bottom: 20px;
    }
.spinner {
   width: 30px;
   height: 30px;
   border-radius: 50%;
   background: radial-gradient(farthest-side,#3358ef 94%,#0000) top/9px 9px no-repeat,
              conic-gradient(#0000 30%,#3358ef);
   -webkit-mask: radial-gradient(farthest-side,#0000 calc(100% - 9px),#000 0);
   animation: spinner-c7wet2 1s infinite linear;
   display: none; /* Hidden by default */
}
@keyframes spinner-c7wet2 {
   100% {
      transform: rotate(1turn);
   }
}
    /* Small spinner for address lookup */
    .spinner-small {
       width: 30px;
       height: 30px;
    }
    /* Medium spinner for submit and Stripe */
    .spinner-medium {
       width: 56px;
       height: 56px;
       margin: 0 auto; /* Center the spinner */
       display: block; /* Block-level for centering */
    }
    h2 {
      font-family: 'Roboto', sans-serif;
      font-weight: 600;
      font-size: 28px;
      margin-bottom: 24px;
    }
    h3 {
      font-family: 'Roboto', sans-serif;
      font-weight: 500;
      font-size: 20px;
      margin-bottom: 16px;
    }
    /* Cancel Button Styling */
    #cancelButton {
      background-color: transparent;
      border: 3px solid #000;
      color: #000;
      font-family: 'Roboto', sans-serif;
      font-size: 16px;
      font-weight: 700;
      padding: 12px 24px;
      cursor: pointer;
      text-align: center;
      display: block;
      margin: 0 auto;
      margin-top: 24px;
      margin-bottom: 24px;
      max-width: 350px;
    }
    #cancelButton:hover {
      background-color: rgba(0, 0, 0, 0.05);
    }
#confirmSubmit {
  background-color: #CEFF4B; /* Lime color */
  border: 3px solid #000; /* Black border */
  border-right-width: 5px; /* Heavier right border */
  border-bottom-width: 5px; /* Heavier bottom border */
  color: #000; /* Black text */
  font-family: 'Roboto', sans-serif;
  font-size: 16px;
  font-weight: 700;
  padding: 12px 24px;
  cursor: pointer;
  text-align: center;
  display: block;
  margin: 0 auto;
  margin-top: 16px;
  margin-bottom: 0px;
  max-width: 350px;
  box-shadow: 3px 3px 0px 0px #000; /* Solid shadow */
}
#confirmSubmit:hover {
  background-color: #B4DC40; /* Lighter lime hover */
  box-shadow: 3px 3px 0px 0px #000;
}
    .button-wrapper {
      margin-top: 30px; 
      text-align: center; 
    }
    /* Disable Confirm and Pay button when in edit mode */
    #confirmSubmit:disabled {
      background-color: #e0e0e0; /* Grey background */
      border: 3px solid #ccc; /* Lighter border */
      color: #999; /* Light grey text */
      cursor: not-allowed;
    }
    /* Highlight Save button when Confirm and Pay is disabled */
    .edit-button.save-mode {
      background-color: #CEFF4B; /* Lime color */
      border: 3px solid #000;
      border-right-width: 5px;
      border-bottom-width: 5px;
    }
    .edit-button.save-mode:hover {
      background-color: #B4DC40;
    }
    /* Hide Note field if empty */
    .field-group.hidden {
      display: none;
    }
    #startOverButton {
      background-color: transparent;
      border: none;
      color: #000;
      font-family: 'Roboto', sans-serif;
      font-size: 16px;
      cursor: pointer;
      text-align: center;
      max-width: 150px;
      margin-top: 10px;
      margin-bottom: 0;
      box-shadow: none; /* No shadow */
    }
    #startOverButton:hover {
      background-color: #FABCBC; 
      color: #000;
    }
    /* Non-editable class for addresses */
    .non-editable {
      display: block;
    }
.autocomplete-container {
  position: relative;
}
.autocomplete-container input {
  padding-right: 40px; /* Reserve space for the spinner */
}
#addressLookupIndicatorCollector {
  position: absolute;
  right: 10px;
  top: 50%;
  transform: translateY(-50%);
  display: none;
  width: 20px; /* Set a fixed width */
  height: 20px; /* Set a fixed height */
  pointer-events: none; /* Prevent interactions with the spinner */
}
.balance-input-container {
  display: flex;
  align-items: center;
  border: 1px solid #ccc;
  border-radius: 4px;
  padding: 0 10px;
  margin-top: 3px;
  width: 100%;
  box-sizing: border-box;
  background-color: #ffffff;
}
.input-prefix {
  font-weight: bold;
  color: #333;
  margin-right: 5px;
}
#balanceInput {
  flex: 1;
  border: none;
  background-color: transparent;
  padding: 8px;
  outline: none;
  font-size: 16px;
}
  </style>
      <script src="https://js.stripe.com/v3/"></script>
    </head>
    <body>
      <div class="container">
        <form id="mailForm">
          <!--  Removed Reason for Dispute from Main Form  -->
          <div class="form-section">
            <h2>Collector Mailing Info</h2>
            <label for="collectorName">Collector Name</label>
            <div class="editable-container">
              <input type="text" id="collectorName" name="collectorName">
            </div>
            <label for="collectorAddress">Collector Address</label>
            <div class="autocomplete-container" id="collector-autocomplete-container">
              <input type="text" id="collectorAddress" name="collectorAddress" required="">
              <div id="addressLookupIndicatorCollector" class="spinner spinner-small"></div>
            </div>
            <label for="collectorCity">Collector City</label>
            <input type="text" id="collectorCity" name="collectorCity" required="">
            <label for="collectorState">Collector State</label>
            <select id="collectorState" name="collectorState" required="">
              <option value="">Select State</option>
              <!--  US states options  -->
              <option value="AL">Alabama</option>
              <option value="AK">Alaska</option>
              <option value="AZ">Arizona</option>
              <option value="AR">Arkansas</option>
              <option value="CA">California</option>
              <option value="CO">Colorado</option>
              <option value="CT">Connecticut</option>
              <option value="DE">Delaware</option>
              <option value="FL">Florida</option>
              <option value="GA">Georgia</option>
              <option value="HI">Hawaii</option>
              <option value="ID">Idaho</option>
              <option value="IL">Illinois</option>
              <option value="IN">Indiana</option>
              <option value="IA">Iowa</option>
              <option value="KS">Kansas</option>
              <option value="KY">Kentucky</option>
              <option value="LA">Louisiana</option>
              <option value="ME">Maine</option>
              <option value="MD">Maryland</option>
              <option value="MA">Massachusetts</option>
              <option value="MI">Michigan</option>
              <option value="MN">Minnesota</option>
              <option value="MS">Mississippi</option>
              <option value="MO">Missouri</option>
              <option value="MT">Montana</option>
              <option value="NE">Nebraska</option>
              <option value="NV">Nevada</option>
              <option value="NH">New Hampshire</option>
              <option value="NJ">New Jersey</option>
              <option value="NM">New Mexico</option>
              <option value="NY">New York</option>
              <option value="NC">North Carolina</option>
              <option value="ND">North Dakota</option>
              <option value="OH">Ohio</option>
              <option value="OK">Oklahoma</option>
              <option value="OR">Oregon</option>
              <option value="PA">Pennsylvania</option>
              <option value="RI">Rhode Island</option>
              <option value="SC">South Carolina</option>
              <option value="SD">South Dakota</option>
              <option value="TN">Tennessee</option>
              <option value="TX">Texas</option>
              <option value="UT">Utah</option>
              <option value="VT">Vermont</option>
              <option value="VA">Virginia</option>
              <option value="WA">Washington</option>
              <option value="WV">West Virginia</option>
              <option value="WI">Wisconsin</option>
              <option value="WY">Wyoming</option>
            </select>
            <label for="collectorZip">Collector ZIP Code</label>
            <input type="text" id="collectorZip" name="collectorZip" required="">
          </div>
          <div class="form-section opt-in-container">
            <input type="checkbox" id="optInEmail" name="optInEmail">
            <label for="optInEmail">I accept the <a href="/tos" target="_blank">Terms</a> and <a href="/privacy-policy" target="_blank">Privacy Policy</a></label>
          </div>
          <button type="submit" id="submitButton" disabled="">Submit</button>
          <div id="submitButtonSpinner" class="spinner spinner-medium" style="display: none;"></div>
        </form>
        <div id="errorMessage"></div>
        <div id="successMessage">Your dispute letter has been received and will be mailed shortly!</div>
      </div>
      <div id="confirmationModal">
        <div id="confirmationModalContent">
          <span class="close" id="modalClose">&times;</span>
          <h2>Review Details</h2>
          <div class="info-card" id="myInfoSection">
            <div class="section-header">
              <h3>My Information</h3>
              <button class="edit-button" id="editMyInfoButton">Edit</button>
            </div>
            <div class="field-group">
              <label class="review-label">Name</label>
              <span id="myInfoNameDisplay" class="review-value"></span>
              <input type="text" id="myInfoNameInput" class="review-input" style="display: none;">
            </div>
            <div class="field-group">
              <label class="review-label">Email</label>
              <span id="myInfoEmailDisplay" class="review-value"></span>
              <input type="email" id="myInfoEmailInput" class="review-input" style="display: none;">
              <!--  Error message placed right after the email input  -->
              <span id="emailError" style="color: red; display: none;">Please enter a valid email address.</span>
              <div class="field-group">
                <label class="review-label">Mailing Address</label>
                <span id="myInfoAddressDisplay" class="review-value non-editable"></span>
                <!--  Mailing Address is not editable  -->
              </div>
            </div>
          </div>
          <div class="info-card" id="accountInfoSection">
            <div class="section-header">
              <h3>Account Information</h3>
              <button class="edit-button" id="editAccountInfoButton">Edit</button>
            </div>
            <div class="field-group">
              <label class="review-label">Debt Balance</label>
              <div class="balance-input-container">
                <span class="input-prefix">$</span>
                <input type="text" id="balanceInput" class="review-input" style="display: none;">
              </div>
              <span id="balanceDisplay" class="review-value"></span>
            </div>
            <div class="field-group">
              <label class="review-label">Dispute Reason</label>
              <span id="disputeReasonDisplay" class="review-value"></span>
              <select id="disputeReasonInput" class="review-select" style="display: none;">
                <option value="I don’t recognize this debt.">I don’t recognize this debt.</option>
                <option value="This debt is not mine.">This debt is not mine.</option>
                <option value="This debt has already been paid.">This debt has already been paid.</option>
                <option value="The amount of the debt is incorrect.">The amount of the debt is incorrect.</option>
              </select>
            </div>
            <div class="field-group">
              <label class="review-label">Dispute Note</label>
              <span id="disputeNoteDisplay" class="review-value"></span>
              <input type="text" id="disputeNoteInput" class="review-input" style="display: none;">
            </div>
            <div class="field-group">
              <label class="review-label">Collector Name</label>
              <span id="collectorNameDisplay" class="review-value"></span>
              <input type="text" id="collectorNameInput" class="review-input" style="display: none;">
            </div>
            <div class="field-group">
              <label class="review-label">Account Number</label>
              <span id="accountNumberDisplay" class="review-value"></span>
              <input type="text" id="accountNumberInput" class="review-input" style="display: none;">
            </div>
            <div class="field-group">
              <label class="review-label">Collector Address</label>
              <span id="collectorAddressDisplay" class="review-value non-editable"></span>
              <!--  Collector Address is not editable  -->
            </div>
          </div>
          <div class="button-wrapper">
            <button id="confirmSubmit">Confirm and Pay $3.99</button>
            <button id="cancelButton" class="cancel-btn">Back</button>
            <button id="startOverButton" class="start-over-btn">Start Over</button>
          </div>
          <div id="confirmSubmitSpinner" class="spinner spinner-medium" style="display: none;"></div>
          <div id="modalLoadingIndicator" class="spinner spinner-medium" style="display: none;"></div>
        </div>
      </div>
      <script>
    document.addEventListener("DOMContentLoaded", function() {
      const stripe = Stripe('pk_test_51PUHRJBcUICL2kM7u5lqolkeQum4hSMBEzTLhbLludWr0fkBe8ukHG7WlY3YexjUCuCpLRBhvt2ogrGpZiEKjJZx00KucM31n6'); 
      const mailForm = document.getElementById('mailForm');
      const optInCheckbox = document.getElementById('optInEmail');
      const submitButton = document.getElementById('submitButton');
      const submitSpinner = document.getElementById('submitButtonSpinner');
      const collectorNameField = document.getElementById('collectorName');
      const addressLookupIndicatorCollector = document.getElementById('addressLookupIndicatorCollector');
      // Retrieve stored data from localStorage
      const storedData = JSON.parse(localStorage.getItem('submittedData') || '{}');
      // Prepopulate the Collector Name field from localStorage
      if (storedData.collectorName) {
        collectorNameField.value = storedData.collectorName;
      }
      // Add event listener to update localStorage when the collector name is changed
      collectorNameField.addEventListener('input', function() {
        storedData.collectorName = collectorNameField.value.trim();
        localStorage.setItem('submittedData', JSON.stringify(storedData));
      });
      optInCheckbox.addEventListener('change', function() {
        submitButton.disabled = !this.checked;
      });
      // Handle address lookup spinner for Collector Address
      document.getElementById('collectorAddress').addEventListener('input', function() {
          addressLookupIndicatorCollector.style.display = 'block'; // Show spinner
          // Simulate address lookup for demo (replace with actual logic)
          setTimeout(() => {
              addressLookupIndicatorCollector.style.display = 'none'; // Hide spinner
          }, 2000);
      });
      // Handle form submission (no Cloudflare submission here, only showing confirmation modal)
      mailForm.addEventListener('submit', async function(event) {
        event.preventDefault();
        // Hide the submit button, show the spinner
        submitButton.style.display = 'none';
        submitSpinner.style.display = 'block';
        // Collect current form data
        const currentFormData = {
          collectorName: collectorNameField.value.trim(),
          collectorAddress: document.getElementById('collectorAddress').value.trim(),
          collectorCity: document.getElementById('collectorCity').value.trim(),
          collectorState: document.getElementById('collectorState').value.trim(),
          collectorZip: document.getElementById('collectorZip').value.trim(),
          optInEmail: document.getElementById('optInEmail').checked ? 'Yes' : 'No'
        };
        // Merge current form data with any existing stored data
        const existingData = JSON.parse(localStorage.getItem('submittedData') || '{}');
        const mergedData = { ...existingData, ...currentFormData };
        localStorage.setItem('submittedData', JSON.stringify(mergedData));
        // Delay before showing the confirmation modal (1.5 seconds)
        setTimeout(() => {
          submitSpinner.style.display = 'none';
          submitButton.style.display = 'block'; // Restore submit button
          showConfirmationModal(mergedData);
        }, 1500); // 1.5 second delay
      });
function isValidEmail(email) {
  // Basic regex for email validation
  const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
  return re.test(email);
}
// Ensure only valid numbers with two decimal places can be inputted for balance
document.getElementById('balanceInput').addEventListener('input', function (e) {
  // Remove any non-numeric characters except dot
  this.value = this.value.replace(/[^0-9.]/g, ''); 
  // Limit to two decimal places
  const parts = this.value.split('.');
  if (parts.length > 1 && parts[1].length > 2) {
    this.value = parts[0] + '.' + parts[1].substring(0, 2);
  }
});
// Ensure only valid numbers with two decimal places can be inputted for balance
document.getElementById('balanceInput').addEventListener('input', function (e) {
  // Remove any non-numeric characters except dot
  this.value = this.value.replace(/[^0-9.]/g, ''); 
  // Limit to two decimal places
  const parts = this.value.split('.');
  if (parts.length > 1 && parts[1].length > 2) {
    this.value = parts[0] + '.' + parts[1].substring(0, 2);
  }
});
      // Function to show the confirmation modal
      function showConfirmationModal(data) {
        const modal = document.getElementById('confirmationModal');
        const confirmSubmit = document.getElementById('confirmSubmit');
        const cancelButton = document.getElementById('cancelButton');
        const modalLoadingIndicator = document.getElementById('modalLoadingIndicator');
        const submitButton = document.getElementById('submitButton');
        const errorMessage = document.getElementById('errorMessage');
        const startOverButton = document.getElementById('startOverButton');
        // Hide the loading spinner explicitly when the modal appears
        modalLoadingIndicator.style.display = 'none'; // Hide spinner
        // Concatenate mailing address
        const mailingAddressFull = `${data.mailingAddress || ''}, ${data.mailingCity || ''}, ${data.mailingState || ''} ${data.mailingZip || ''}`;
        // Concatenate collector address
        const collectorAddressFull = `${data.collectorAddress || ''}, ${data.collectorCity || ''}, ${data.collectorState || ''} ${data.collectorZip || ''}`;
        // Populate modal details with display spans
        document.getElementById('myInfoNameDisplay').innerText = `${data.firstName || ''} ${data.lastName || ''}`;
        document.getElementById('myInfoEmailDisplay').innerText = data.email || '';
        document.getElementById('myInfoAddressDisplay').innerText = mailingAddressFull;
        document.getElementById('balanceDisplay').innerText = formatBalance(data.balance || '');
        document.getElementById('balanceInput').value = formatBalanceForEdit(data.balance || '');
        document.getElementById('disputeReasonDisplay').innerText = data.reasonForDispute || '';
        document.getElementById('disputeNoteDisplay').innerText = data.disputeNote || '';
        document.getElementById('collectorNameDisplay').innerText = data.collectorName || '';
        document.getElementById('accountNumberDisplay').innerText = data.accountNumber || '';
        document.getElementById('collectorAddressDisplay').innerText = collectorAddressFull;
        // Hide input fields
        document.querySelectorAll('.review-input, .review-select').forEach(function(input) {
          input.style.display = 'none';
        });
        // Show display spans
        document.querySelectorAll('.review-value').forEach(function(span) {
          span.style.display = 'block';
        });
        modal.style.display = 'block'; // Display the modal
        // Remove event listener for clicking outside the modal
        window.onclick = function (event) {
          if (event.target === modal) {
            modal.style.display = 'none';
            submitButton.style.display = 'block'; // Restore submit button on click outside modal
          }
        };
        // Handle cancel button and modal close
        cancelButton.onclick = function () {
          modal.style.display = 'none';
          submitButton.style.display = 'block'; // Restore submit button on cancel
        };
        document.getElementById('modalClose').onclick = function () {
          modal.style.display = 'none';
          submitButton.style.display = 'block'; // Restore submit button on close
        };
        startOverButton.onclick = function () {
          window.location.href = '/dispute'; // Redirect to "/dispute"
        };
        // Disable Confirm and Pay button if any section is in edit mode
        confirmSubmit.disabled = false;
        // Handle Confirm and Pay button click
        confirmSubmit.onclick = async function () {
          // Ensure no section is in edit mode
          if (isEditingMyInfo || isEditingAccountInfo) {
            return;
          }
          // Fetch latest data from input fields (if any edits were made)
          const updatedData = JSON.parse(localStorage.getItem('submittedData') || '{}');
          // Update local storage
          localStorage.setItem('submittedData', JSON.stringify(updatedData));
          confirmSubmit.style.display = 'none';
          cancelButton.style.display = 'none';
          document.getElementById('startOverButton').style.display = 'none';
          modalLoadingIndicator.style.display = 'block'; // Show the spinner
          // Add letterType attribute on second submit
          updatedData.letterType = 'first_class';
          localStorage.setItem('submittedData', JSON.stringify(updatedData));
          // Proceed with the data submission to Cloudflare
          let submissionCompleted = false;
          const timeoutPromise = new Promise((resolve) => {
            setTimeout(() => {
              resolve('timeout');
            }, 10000); // 10 seconds timeout
          });
          const submissionPromise = submitDataToWorker(updatedData).then((result) => {
            submissionCompleted = true;
            return result;
          });
          const finalResult = await Promise.race([submissionPromise, timeoutPromise]);
          if (finalResult === 'timeout' && !submissionCompleted) {
            console.log('Data submission timed out. Proceeding to Stripe.');
          } else {
            console.log('Data submitted successfully.');
          }
          // Proceed to Stripe checkout
          try {
            const response = await fetch('https://stripe-worker3.debtcatai.workers.dev/', {
              method: 'POST',
              headers: {
                'Content-Type': 'application/json',
              },
              body: JSON.stringify({ /* your session data */ })
            });
            const session = await response.json();
            if (!session || session.error || !session.id) {
              throw new Error(session.error || 'Failed to create session');
            }
            const result = await stripe.redirectToCheckout({
              sessionId: session.id
            });
            if (result.error) {
              throw new Error(result.error.message);
            }
          } catch (error) {
            errorMessage.textContent = error.message;
            errorMessage.style.display = 'block';
          } finally {
            modalLoadingIndicator.style.display = 'none'; // Hide spinner after submission
            confirmSubmit.style.display = 'block';
            cancelButton.style.display = 'block';
            document.getElementById('startOverButton').style.display = 'block';
          }
        };
      }
      // Function to submit data to the Cloudflare Worker
      async function submitDataToWorker(data) {
        try {
          const response = await fetch('https://stripe-worker3.debtcatai.workers.dev/', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify(data)
          });
          if (!response.ok) {
            throw new Error('Network response was not ok');
          }
          const result = await response.json();
          return result;
        } catch (error) {
          console.error('Error submitting data to worker:', error);
          throw error;
        }
      }
// Autocomplete function for address input with all special conditions
function addressAutocomplete(containerElement, addressType) {
    const inputElement = containerElement.querySelector('input');
    const spinnerElement = document.getElementById('addressLookupIndicatorCollector');
    let currentPromiseReject;
    // Check if the manual override is already set
    if (sessionStorage.getItem('manualOverride')) {
        inputElement.removeEventListener("input", triggerAutocomplete);
        return; // Stop autocomplete if manual override is set
    }
    inputElement.addEventListener("input", triggerAutocomplete);
    function triggerAutocomplete(e) {
        closeDropDownList();
        const currentValue = this.value;
        if (currentValue.length < 3) return false;
        if (currentPromiseReject) currentPromiseReject({ canceled: true });
        if (!currentValue) return false;
        spinnerElement.style.display = 'block';
        const promise = new Promise((resolve, reject) => {
            currentPromiseReject = reject;
            const url = `https://wrkr1.debtcatai.workers.dev/?query=${encodeURIComponent(currentValue)}&limit=5`;
            fetch(url, {
                method: 'GET',
                headers: {
                    'Content-Type': 'application/json'
                },
                mode: 'cors',
                credentials: 'omit'
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                return response.json();
            })
            .then(resolve)
            .catch(error => {
                console.error('Fetch error:', error);
                reject(error);
            });
        });
        promise.then((data) => {
            spinnerElement.style.display = 'none';
            console.log('API Response:', data);
            const autocompleteItemsElement = document.createElement("div");
            autocompleteItemsElement.setAttribute("class", "autocomplete-items");
            containerElement.appendChild(autocompleteItemsElement);
            if (data && data.type === 'FeatureCollection' && Array.isArray(data.features)) {
                if (data.features.length === 0) {
                    const noResultsElement = document.createElement("DIV");
                    noResultsElement.innerHTML = 'No results found';
                    const dismissButton = createDismissButton(inputElement);
                    noResultsElement.appendChild(dismissButton);
                    autocompleteItemsElement.appendChild(noResultsElement);
                } else {
                    data.features.forEach((feature, index) => {
                        const formattedAddress = formatAddress(feature);
                        const itemElement = document.createElement("DIV");
                        itemElement.innerHTML = formattedAddress;
                        // Add dismiss button to the first result
                        if (index === 0) {
                            const dismissButton = createDismissButton(inputElement);
                            itemElement.appendChild(dismissButton);
                        }
                        itemElement.addEventListener("click", function(e) {
                            // Populate the fields with selected address data
                            inputElement.value = `${feature.properties.housenumber || ''} ${feature.properties.street || ''}`;
                            document.getElementById('collectorCity').value = feature.properties.city || '';
                            selectState(feature.properties.state);
                            document.getElementById('collectorZip').value = feature.properties.postcode || '';
                            closeDropDownList();
                        });
                        autocompleteItemsElement.appendChild(itemElement);
                    });
                }
            } else {
                console.error('Invalid data structure received from API');
                showErrorElement(containerElement, inputElement);
            }
        }).catch((err) => {
            spinnerElement.style.display = 'none';
            if (!err.canceled) {
                console.error('Error in address autocomplete:', err);
                showErrorElement(containerElement, inputElement);
            }
        });
    }
    function closeDropDownList() {
        const autocompleteItemsElement = containerElement.querySelector(".autocomplete-items");
        if (autocompleteItemsElement) {
            containerElement.removeChild(autocompleteItemsElement);
        }
    }
    function createDismissButton(inputElement) {
        const dismissButton = document.createElement("span");
        dismissButton.className = 'close-btn';
        dismissButton.innerHTML = 'X';
        dismissButton.addEventListener("click", () => {
            closeDropDownList();
            sessionStorage.setItem('manualOverride', true); 
            inputElement.removeEventListener("input", triggerAutocomplete); 
        });
        return dismissButton;
    }
    function formatAddress(feature) {
        return `${feature.properties.housenumber || ''} ${feature.properties.street || ''}, ${feature.properties.city || ''}, ${feature.properties.state || ''} ${feature.properties.postcode || ''}`;
    }
    function showErrorElement(containerElement, inputElement) {
        const autocompleteItemsElement = document.createElement("div");
        autocompleteItemsElement.setAttribute("class", "autocomplete-items");
        const errorElement = document.createElement("DIV");
        errorElement.innerHTML = 'Error fetching address suggestions';
        const dismissButton = createDismissButton(inputElement);
        errorElement.appendChild(dismissButton);
        autocompleteItemsElement.appendChild(errorElement);
        containerElement.appendChild(autocompleteItemsElement);
    }
    function selectState(stateName) {
        const stateSelect = document.getElementById('collectorState');
        if (stateSelect && stateName) {
            for (const option of stateSelect.options) {
                if (option.text.toLowerCase() === stateName.toLowerCase()) {
                    stateSelect.value = option.value;
                    break;
                }
            }
        }
    }
}
// Initialize address autocomplete for the main form
addressAutocomplete(document.getElementById("collector-autocomplete-container"), 'collector');
      // Variables to track edit mode
      let isEditingMyInfo = false;
      let isEditingAccountInfo = false;
      function toggleEditSave(sectionElement, isEditing, editButton) {
        const spans = sectionElement.querySelectorAll('.review-value');
        const inputs = sectionElement.querySelectorAll('.review-input, .review-select');
        const confirmSubmitButton = document.getElementById('confirmSubmit');
        if (isEditing) {
          // Hide spans (original display values), except for non-editable ones
          spans.forEach(span => {
            if (!span.classList.contains('non-editable')) {
              span.style.display = 'none';
            }
          });
          // Show inputs
          inputs.forEach(input => {
            input.style.display = 'block';
            input.disabled = false;
          });
          editButton.textContent = 'Save';
          // Highlight Save button
          editButton.classList.add('save-mode');
          // Disable the Confirm and Pay button
          confirmSubmitButton.disabled = true;
        } else {
          // Show spans, hide inputs
          spans.forEach(span => {
            span.style.display = 'block';
          });
          inputs.forEach(input => {
            input.style.display = 'none';
            input.disabled = true;
          });
          editButton.textContent = 'Edit';
          // Remove highlight from Save button
          editButton.classList.remove('save-mode');
          // Re-enable the Confirm and Pay button if no sections are in edit mode
          if (!isEditingMyInfo && !isEditingAccountInfo) {
            confirmSubmitButton.disabled = false;
          }
        }
      }
function formatBalance(balance) {
  if (!balance) return '';
  return `$${parseFloat(balance).toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2})}`;
}
function formatBalanceForEdit(balance) {
  if (!balance) return '';
  return `$${balance}`;
}
document.getElementById('editMyInfoButton').addEventListener('click', function() {
  const sectionElement = this.parentElement.parentElement;
  isEditingMyInfo = !isEditingMyInfo;
  toggleEditSave(sectionElement, isEditingMyInfo, this);
  const emailError = document.getElementById('emailError');
  if (!isEditingMyInfo) {
    // Saving mode
    const updatedData = JSON.parse(localStorage.getItem('submittedData') || '{}');
    // Get name and email input values
    const nameValue = document.getElementById('myInfoNameInput').value.trim();
    const emailValue = document.getElementById('myInfoEmailInput').value.trim();
    // Name splitting for first and last name
    const nameParts = nameValue.split(' ');
    updatedData.firstName = nameParts[0] || '';  // Assign first part as first name
    updatedData.lastName = nameParts.slice(1).join(' ') || '';  // Assign rest as last name
    // Email validation
    if (!isValidEmail(emailValue)) {
      emailError.style.display = 'block'; // Show error message
      // Keep the edit mode on
      isEditingMyInfo = true;
      toggleEditSave(sectionElement, isEditingMyInfo, this);
      return;  // Stop here, invalid email
    } else {
      emailError.style.display = 'none'; // Hide error message
    }
    // Store updated data in localStorage
    updatedData.email = emailValue;
    localStorage.setItem('submittedData', JSON.stringify(updatedData));
    // Update displayed values
    document.getElementById('myInfoNameDisplay').innerText = nameValue;
    document.getElementById('myInfoEmailDisplay').innerText = updatedData.email;
  } else {
    // Editing mode - Pre-fill inputs with current data
    document.getElementById('myInfoNameInput').value = document.getElementById('myInfoNameDisplay').innerText;
    document.getElementById('myInfoEmailInput').value = document.getElementById('myInfoEmailDisplay').innerText;
    emailError.style.display = 'none'; // Hide email error message when entering edit mode
  }
});
// Format balance for display (with dollar sign and two decimal places)
function formatBalance(balance) {
  if (!balance) return '';
  return `$${parseFloat(balance).toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`;
}
// Handle 'Edit/Save' for Account Information
document.getElementById('editAccountInfoButton').addEventListener('click', function() {
  const sectionElement = this.parentElement.parentElement;
  isEditingAccountInfo = !isEditingAccountInfo;  // Toggle between editing and saving modes
  toggleEditSave(sectionElement, isEditingAccountInfo, this);  // Call helper function to handle visual changes
  const balanceInputContainer = document.querySelector('.balance-input-container');
  const balanceInput = document.getElementById('balanceInput');
  const balanceDisplay = document.getElementById('balanceDisplay');
  if (!isEditingAccountInfo) {
    // Saving mode: Retrieve updated information and save to localStorage
    const updatedData = JSON.parse(localStorage.getItem('submittedData') || '{}');
    // Save balance (removing non-numeric characters)
    updatedData.balance = parseFloat(balanceInput.value.replace(/[^0-9.-]+/g, ""));
    // Save other fields to updatedData
    updatedData.reasonForDispute = document.getElementById('disputeReasonInput').value;
    updatedData.disputeNote = document.getElementById('disputeNoteInput').value.trim();
    updatedData.collectorName = document.getElementById('collectorNameInput').value.trim();
    updatedData.accountNumber = document.getElementById('accountNumberInput').value.trim();
    // Store the updated data object in localStorage
    localStorage.setItem('submittedData', JSON.stringify(updatedData));
    // Update the display spans with the saved data
    balanceDisplay.innerText = formatBalance(updatedData.balance);
    document.getElementById('disputeReasonDisplay').innerText = updatedData.reasonForDispute;
    document.getElementById('disputeNoteDisplay').innerText = updatedData.disputeNote;
    document.getElementById('collectorNameDisplay').innerText = updatedData.collectorName;
    document.getElementById('accountNumberDisplay').innerText = updatedData.accountNumber;
    // Hide the Note field group if the disputeNote is empty
    if (!updatedData.disputeNote || updatedData.disputeNote.trim() === '') {
      document.getElementById('noteFieldGroup').classList.add('hidden');
    } else {
      document.getElementById('noteFieldGroup').classList.remove('hidden');
    }
    // Hide the balance input container and show the balance display span
    balanceInputContainer.style.display = 'none';  
    balanceDisplay.style.display = 'block';  // Show the formatted balance display
  } else {
    // Editing mode: Pre-fill the input fields with current data from the display spans
    balanceInput.value = balanceDisplay.innerText.replace('$', '');  // Remove the dollar sign for input field
    balanceInputContainer.style.display = 'flex';  // Show the input container
    balanceDisplay.style.display = 'none';  // Hide the balance display
    // Pre-fill other input fields
    document.getElementById('disputeReasonInput').value = document.getElementById('disputeReasonDisplay').innerText;
    document.getElementById('disputeNoteInput').value = document.getElementById('disputeNoteDisplay').innerText;
    document.getElementById('collectorNameInput').value = document.getElementById('collectorNameDisplay').innerText;
    document.getElementById('accountNumberInput').value = document.getElementById('accountNumberDisplay').innerText;
  }
});
// Format balance for display (with dollar sign and two decimal places)
function formatBalance(balance) {
  if (!balance) return '';
  return `$${parseFloat(balance).toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`;
}
    });
  </script>
    </body>
    </html>
  </div>
  <script src="https://d3e54v103j8qbb.cloudfront.net/js/jquery-3.5.1.min.dc5e7f18c8.js?site=66567a3f3727972f31237c21" type="text/javascript" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
  <script src="../js/webflow.js" type="text/javascript"></script>
</body>
</html>