<!DOCTYPE html><!--  Last Published: Thu Feb 06 2025 20:19:31 GMT+0000 (Coordinated Universal Time)  -->
<html data-wf-page="66f180e19e7c30de3b9578a0" data-wf-site="66567a3f3727972f31237c21">
<head>
  <meta charset="utf-8">
  <title>Dispute Options - Test</title>
  <meta content="Dispute Options - Test" property="og:title">
  <meta content="Dispute Options - Test" property="twitter:title">
  <meta content="width=device-width, initial-scale=1" name="viewport">
  <meta content="6e09m7Tfl6u4e-eTXMXpwCbUlW_YC8oVpyv0EL-XU9k" name="google-site-verification">
  <meta content="noindex" name="robots">
  <link href="../css/normalize.css" rel="stylesheet" type="text/css">
  <link href="../css/webflow.css" rel="stylesheet" type="text/css">
  <link href="../css/debtcat.webflow.css" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com" rel="preconnect">
  <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin="anonymous">
  <script src="https://ajax.googleapis.com/ajax/libs/webfont/1.6.26/webfont.js" type="text/javascript"></script>
  <script type="text/javascript">WebFont.load({  google: {    families: ["Montserrat:100,100italic,200,200italic,300,300italic,400,400italic,500,500italic,600,600italic,700,700italic,800,800italic,900,900italic","Merriweather:300,300italic,400,400italic,700,700italic,900,900italic","Roboto:100,300,regular,500,700,900"]  }});</script>
  <script type="text/javascript">!function(o,c){var n=c.documentElement,t=" w-mod-";n.className+=t+"js",("ontouchstart"in o||o.DocumentTouch&&c instanceof DocumentTouch)&&(n.className+=t+"touch")}(window,document);</script>
  <link href="../images/favicon.png" rel="shortcut icon" type="image/x-icon">
  <link href="../images/webclip.png" rel="apple-touch-icon">
  <script async="" src="https://www.googletagmanager.com/gtag/js?id=G-DMRMQNLTBZ"></script>
  <script type="text/javascript">window.dataLayer = window.dataLayer || [];function gtag(){dataLayer.push(arguments);}gtag('js', new Date());gtag('set', 'developer_id.dZGVlNj', true);gtag('config', 'G-DMRMQNLTBZ');</script><!--  Google tag (gtag.js) ** MOVED to site settings/integrations"
<script async src="https://www.googletagmanager.com/gtag/js?id=G-DMRMQNLTBZ"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-DMRMQNLTBZ');
</script>   -->
  <!--   MS Clarity   -->
  <script type="text/javascript">
    (function(c,l,a,r,i,t,y){
        c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)};
        t=l.createElement(r);t.async=1;t.src="https://www.clarity.ms/tag/"+i;
        y=l.getElementsByTagName(r)[0];y.parentNode.insertBefore(t,y);
    })(window, document, "clarity", "script", "oc17kv2js6");
</script>
  <script>
  // Define the getIP function before loading the ipify script
  function getIP(json) {
    userIP = json.ip;
  }
  // Initialize the userIP variable
  let userIP = '';
</script>
  <script src="https://api.ipify.org?format=jsonp&callback=getIP"></script>
  <link rel="stylesheet" href="https://unpkg.com/@geoapify/geocoder-autocomplete@^1/styles/minimal.css">
</head>
<body class="body">
  <div class="w-layout-blockcontainer container-body w-container">
    <div class="navbar">
      <div data-animation="default" data-collapse="medium" data-duration="400" data-easing="ease" data-easing2="ease" role="banner" class="navbar-no-shadow-container w-nav">
        <div class="container-regular">
          <div class="navbar-wrapper">
            <a href="../index.html" class="navbar-brand w-nav-brand"><img src="../images/debtcat-logo-inverse.svg" loading="lazy" width="70" height="Auto" alt="DebtCat logo" class="logo-header"></a>
            <nav role="navigation" class="nav-menu-wrapper w-nav-menu">
              <ul role="list" class="nav-menu w-list-unstyled">
                <li class="list-item">
                  <a href="../start-dispute.html" class="nav-link h4-montserrat-navbar">Dispute</a>
                </li>
                <li class="list-item">
                  <a href="../chat.html" class="nav-link h4-montserrat-navbar">Chat</a>
                </li>
                <li class="list-item">
                  <a href="../articles.html" class="nav-link h4-montserrat-navbar">Guides</a>
                </li>
                <li class="list-item">
                  <a href="../s/about.html" class="nav-link h4-montserrat-navbar">About Us</a>
                </li>
              </ul>
            </nav>
            <address class="menu-button w-nav-button">
              <div class="icon w-icon-nav-menu"></div>
            </address>
          </div>
        </div>
      </div>
    </div>
    <div class="w-layout-blockcontainer content-container w-container">
      <section>
        <div class="w-embed w-script">
          <!DOCTYPE html>
          <html lang="en">
          <head>
            <meta charset="UTF-8">
            <meta name="viewport" content="width=device-width, initial-scale=1.0">
            <style>
@import url('https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&display=swap');
body {
  display: flex;
  justify-content: center;
  align-items: flex-start;
  height: 100vh;
  background-color: #f0f0f0;
  font-family: 'Montserrat', sans-serif;
  margin: 0;
  padding: 20px;
  box-sizing: border-box;
}
.container {
  display: flex;
  flex-direction: column;
  justify-content: flex-start;
  align-items: center;
  text-align: center;
  background-color: #ffffff;
  padding: 20px;
  border-radius: 16px;
  box-shadow: 0 0 20px rgba(0, 0, 0, 0.1);
  width: 100%;
  max-width: 400px;
  position: relative;
  margin: 0 auto;
}
.info-message {
  color: #1A1A1E;
  font-size: 1.5em;
  margin-bottom: 20px;
}
.subtext {
  color: gray;
  font-size: 0.9em;
  margin-bottom: 20px;
  line-height: 1.5;
}
.subtext a {
  color: #1A1A1E;
  text-decoration: underline;
  white-space: nowrap;
}
.button-container {
  display: flex;
  flex-direction: column;
  gap: 20px;
  width: 100%;
}
.card {
  background-color: #FFFFFF;
  padding: 20px;
  border-radius: 12px;
  border: 3px solid #000000;
  box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
  text-align: left;
  position: relative;
  cursor: pointer;
  display: flex;
  flex-direction: column;
  align-items: flex-start;
  transition: background-color 0.3s;
}
.card:hover {
  background-color: #E1E1E1;
}
.image-placeholder {
  background-color: #CEFF4B;
  width: 40px;
  height: 40px;
  border-radius: 8px;
  margin-right: 20px;
}
.card-content {
  flex-grow: 1;
  width: 100%;
}
.price {
  font-size: 1.2em;
  font-weight: bold;
  color: #000000;
  margin: 0;
}
.card span {
  display: block;
  margin-top: 5px;
  color: #808080;
  font-size: 0.9em;
}
button, a {
  padding: 0;
  border: none;
  background: none;
  display: block;
  width: 100%;
  text-align: left;
  cursor: pointer;
  text-decoration: none;
  color: inherit;
}
button:hover, a:hover {
  background-color: transparent;
}
#emailInputSection {
  display: none;
  text-align: left;
  margin-top: 20px;
  width: 100%;
}
#emailInputSection input[type="email"] {
  width: 100%;
  padding: 10px;
  margin-bottom: 10px;
  border-radius: 5px;
  border: 1px solid #ccc;
  font-size: 1em;
}
#emailInputSection label {
  display: flex;
  align-items: flex-start;
  font-size: 0.9em;
  margin-bottom: 20px;
  line-height: 1.2;
  width: 100%;
}
#emailInputSection label input[type="checkbox"] {
  margin-right: 10px;
  margin-top: 2px;
  transform: scale(1.5);
}
#emailInputSection button {
  width: 100%;
  padding: 10px 20px;
  background-color: #F5F5F5;
  color: #000000;
  border: 3px solid #000000;
  border-radius: 12px;
  cursor: pointer;
  transition: background-color 0.3s, transform 0.2s;
  font-size: 1em;
  text-align: center;
}
#emailInputSection button:hover {
  background-color: #CEFF4B;
}
#emailInputSection button:active {
  background-color: #B4DC40;
  transform: translateY(2px);
}
#emailInputSection button:disabled {
  background-color: #ccc;
  cursor: not-allowed;
  opacity: 0.6;
}
#emailInputSection label a {
  color: #3358EF;
  text-decoration: none;
  white-space: nowrap;
}
#emailInputSection label span {
  display: inline;
}
#emailInputSection label a:hover {
  text-decoration: underline;
}
.expanded {
  display: block;
}
#downloadDisputeButton {
  background-color: #f5f5f5;
  padding: 20px;
  border-radius: 12px;
  border: 3px solid #000000;
  box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
  text-align: left;
  position: relative;
  display: flex;
  align-items: center;
  transition: background-color 0.3s;
}
#downloadDisputeButton:hover {
  background-color: #E1E1E1;
}
.section-title {
  font-size: 1.3em;
  font-weight: bold;
  margin-top: 30px;
  margin-bottom: 10px;
  color: #1A1A1E;
  text-align: center;
}
#captchaContainer {
  margin-top: 20px;
  margin-bottom: 20px;
  width: 100%;
  text-align: center;
}
.spinner {
    width: 56px;
    height: 56px;
    border-radius: 50%;
    background: radial-gradient(farthest-side, #3358ef 94%, transparent) top/9px 9px no-repeat,
    conic-gradient(transparent 30%, #3358ef);
    -webkit-mask: radial-gradient(farthest-side, transparent calc(100% - 9px), #000 0);
    animation: spinner-c7wet2 1s infinite linear;
    margin: 0 auto;  /* Ensures spinner is centered horizontally */
}
@keyframes spinner-c7wet2 {
    100% {
        transform: rotate(1turn);
    }
}
#loadingIndicator {
    width: 28px;  /* Smaller size */
    height: 28px;
    margin: 0 auto;  /* Centered */
    display: none;
}
.modal {
  display: none;
  position: fixed;
  z-index: 1000;
  left: 0;
  top: 0;
  width: 100%;
  height: 100%;
  background-color: rgba(255, 255, 255, 0.95);
}
.modal-content {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
  align-items: center;
}
.email-spinner {
    width: 28px;  /* Smaller size for email spinner */
    height: 28px;
    margin: 0 auto;  /* Centered */
    border-radius: 50%;
    background: radial-gradient(farthest-side, #3358ef 94%, transparent) top/9px 9px no-repeat,
    conic-gradient(transparent 30%, #3358ef);
    -webkit-mask: radial-gradient(farthest-side, transparent calc(100% - 9px), #000 0);
    animation: spinner-c7wet2 1s infinite linear;
}
#emailDisputeButton.expanded:hover {
  background-color: #FFFFFF; 
  cursor: default;           
  pointer-events: none;       
  box-shadow: none;          
  transition: none;          
}
    .email-card-expanded:hover {
      background-color: #FFFFFF !important;
</style>
          </head>
          <body>
            <div class="container" id="disputeContainer">
              <div class="section-title">Dispute Options</div>
              <div class="subtext" style="display: inline;">
                Collectors must validate a disputed debt per the
                <a href="https://www.ftc.gov/legal-library/browse/rules/fair-debt-collection-practices-act-text" target="_blank" style="display: inline;">FDCPA</a>.
                Most do it for all, but they are legally only obligated in the first 30 days. They may use email or mail, depending on their preference.
              </div>
              <!--  DebtCat Mailings Section  -->
              <div class="section-title">DebtCat Mailings</div>
              <div class="button-container">
                <button class="card" id="firstClassMailButton">
                  <div class="image-container">
                    <img src="../images/mail-icon.svg" alt="Mail Icon" class="card-image">
                  </div>
                  <div class="card-content">
                    <div class="price">First Class Mail for $6.99</div>
                    <span>We print and mail your dispute letter through USPS First Class.</span>
                  </div>
                </button>
                <button class="card" id="certifiedMailButton">
                  <div class="image-container">
                    <img src="../images/certified-icon.svg" alt="Certified Mail Icon" class="card-image">
                  </div>
                  <div class="card-content">
                    <div class="price">Certified Mail for $12.99</div>
                    <span>We print and send your letter with tracking and proof of delivery.</span>
                  </div>
                </button>
              </div>
              <!--  Dispute Myself Section  -->
              <div class="section-title">Dispute Myself</div>
              <div class="button-container">
                <button id="downloadDisputeButton" class="card">
                  <div class="image-container">
                    <img src="../images/download-icon.svg" alt="Download PDF Icon" class="card-image">
                  </div>
                  <div class="card-content">
                    <div class="price">Download PDF for FREE</div>
                    <span>Get a PDF of your dispute letter to send yourself.</span>
                  </div>
                </button>
                <div class="card" id="emailDisputeButton">
                  <div class="image-container">
                    <img src="../images/email-icon.svg" alt="Email Copy Icon" class="card-image">
                  </div>
                  <div class="card-content">
                    <div class="price">Email Myself FREE</div>
                    <span>We will send you a copy of your dispute letter.</span>
                  </div>
                  <div id="emailInputSection">
                    <label for="emailAddress">Confirm your email address</label>
                    <input type="email" id="emailAddress" placeholder="Enter your email">
                    <label>
                      <input type="checkbox" id="saveEmail">
                      <span style="display: inline;">
                        By submitting, I agree to the
                        <a href="/tos" target="_blank" style="display: inline;">Terms of Service</a>
                        and
                        <a href="/privacy-policy" target="_blank" style="display: inline;">Privacy Policy</a>.
                      </span>
                    </label>
                    <div id="captchaContainer"></div>
                    <button id="submitEmailButton" disabled="">Submit</button>
                    <div id="loadingIndicator" class="email-spinner" style="display: none;"></div> <!--  Updated spinner  -->
                  </div>
                </div>
              </div>
              <!--  Loading Modal with Spinner  -->
              <div id="loadingModal" class="modal">
                <div class="modal-content">
                  <div class="spinner"></div>
                  <h4><br>Generating your PDF, please wait...</h4>
                </div>
              </div>
            </div>
            <div id="timeoutMessage" style="display:none; color: red;"></div>
            <div id="rateLimitMessage" style="display:none; color: red;"></div>
            <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.4.0/jspdf.umd.min.js"></script>
            <script>
// Global variables
let captchaWidgetId = null;
let emailPopulated = false;
let captchaCompleted = false; // New flag to track CAPTCHA completion
const MAX_CAPTCHA_LOAD_ATTEMPTS = 3;
const TURNSTILE_SITEKEY = '0x4AAAAAAAiA6_L9K0nk7Zwy';
const WORKER_URL = 'https://turnstile-worker-d.debtcatai.workers.dev/';
// Rate limiter
const rateLimiter = (() => {
    let requestCount = 0;
    const requestLimit = 2;
    const requestWindow = 60000; // 1 minute in milliseconds
    let firstRequestTime = null;
    return () => {
        const now = Date.now();
        if (!firstRequestTime || now - firstRequestTime > requestWindow) {
            firstRequestTime = now;
            requestCount = 1;
            return true;
        } else if (requestCount < requestLimit) {
            requestCount++;
            return true;
        } else {
            document.getElementById('rateLimitMessage').innerText = 'Rate limit exceeded. Please wait before submitting again.';
            document.getElementById('rateLimitMessage').style.display = 'block';
            return false;
        }
    };
})();
// Load Turnstile script
function loadTurnstileScript() {
    return new Promise((resolve, reject) => {
        if (document.getElementById('turnstileScript')) {
            resolve();
            return;
        }
        const script = document.createElement('script');
        script.src = "https://challenges.cloudflare.com/turnstile/v0/api.js?render=explicit";
        script.async = true;
        script.defer = true;
        script.id = 'turnstileScript';
        script.onload = resolve;
        script.onerror = () => reject(new Error('Failed to load Turnstile script'));
        document.body.appendChild(script);
    });
}
// Load CAPTCHA
async function loadCaptcha() {
    const captchaContainer = document.getElementById('captchaContainer');
    let attempts = 0;
    while (attempts < MAX_CAPTCHA_LOAD_ATTEMPTS) {
        try {
            await new Promise(resolve => setTimeout(resolve, 500)); // Wait for Turnstile to be ready
            if (typeof turnstile === 'undefined') {
                throw new Error('Turnstile not ready');
            }
            if (captchaWidgetId !== null) {
                turnstile.reset(captchaWidgetId);
                return;
            }
            captchaContainer.innerHTML = '';
            captchaWidgetId = turnstile.render('#captchaContainer', {
                sitekey: TURNSTILE_SITEKEY,
                callback: () => {
                    captchaCompleted = true; // CAPTCHA completed successfully
                    validateForm();
                },
                'error-callback': () => {
                    captchaCompleted = false;
                    throw new Error('Turnstile encountered an error');
                }
            });
            return;
        } catch (error) {
            console.error('Error rendering CAPTCHA:', error);
            attempts++;
        }
    }
    handleCaptchaError('Failed to load CAPTCHA after multiple attempts. Please refresh the page and try again.');
}
// Handle CAPTCHA errors
function handleCaptchaError(message) {
    const captchaContainer = document.getElementById('captchaContainer');
    captchaContainer.innerHTML = `<p style="color: red;">${message}</p>`;
    document.getElementById('submitEmailButton').disabled = true;
}
// Validate email format
function validateEmail(email) {
    return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
}
// Validate form - CAPTCHA + Checkbox + Email
function validateForm() {
    const email = document.getElementById('emailAddress').value.trim();
    const isEmailValid = validateEmail(email);
    const isCheckboxChecked = document.getElementById('saveEmail').checked;
    const isFormValid = isEmailValid && isCheckboxChecked && captchaCompleted; // Include CAPTCHA check
    document.getElementById('submitEmailButton').disabled = !isFormValid;
}
// Utility Function to Convert Blob to Base64
function blobToBase64(blob) {
    return new Promise((resolve, reject) => {
        const reader = new FileReader();
        reader.readAsDataURL(blob);
        reader.onloadend = () => {
            const base64String = reader.result.split(',')[1]; // Remove the data URL prefix
            resolve(base64String);
        };
        reader.onerror = error => reject(error);
    });
}
// PDF Generation Function for Download
function generatePdf() {
    const loadingModal = document.getElementById('loadingModal');
    loadingModal.style.display = 'block'; // Show the modal with the spinner
    setTimeout(() => {
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF();
        const formData = JSON.parse(localStorage.getItem('submittedData'));
        const {
            firstName,
            lastName,
            email,
            address,
            city,
            state,
            zip,
            accountNumber,
            balance,
            collectorName,
            reasonForDispute,
            disputeNote
        } = formData || {};
        const fullName = `${firstName || ''} ${lastName || ''}`.trim();
        if (!fullName) {
            console.error("Full name is undefined");
        }
        const pageWidth = doc.internal.pageSize.getWidth();
        const margin = 20; // Increased margin to prevent text from touching the edges
        const lineHeight = 6; // Adjusted for better readability
        let yPosition = 20;
        // **1. Date**
        yPosition += lineHeight * 2; // Increased spacing at the top
        const currentDate = new Date().toLocaleDateString('en-US', {
            year: 'numeric',
            month: 'long',
            day: 'numeric'
        });
        doc.text(`${currentDate}`, margin, yPosition);
        // **2. Sender's Information**
        yPosition += lineHeight * 1.2;
        doc.setFontSize(12);
        doc.text(fullName, margin, yPosition);
        yPosition += lineHeight;
        const fullAddress = `${address}, ${city}, ${state} ${zip}`.trim();
        doc.text(fullAddress, margin, yPosition);
        yPosition += lineHeight;
        doc.text(`${email}`, margin, yPosition);
        // **3. Account Details**
        yPosition += lineHeight * 1.5;
        // Format the balance with commas and two decimal places
        const numericBalance = Number(balance);
        let formattedBalance = "0.00";
        if (!isNaN(numericBalance)) {
            formattedBalance = numericBalance.toLocaleString('en-US', {
                minimumFractionDigits: 2,
                maximumFractionDigits: 2
            });
        } else {
            console.error("Invalid balance value:", balance);
        }
        // Insert the account number and formatted balance into the PDF
        doc.text(`Account Number: ${accountNumber}`, margin, yPosition);
        yPosition += lineHeight;
        doc.text(`Account Balance: $${formattedBalance}`, margin, yPosition);
        // **4. Subject Line**
        yPosition += lineHeight * 1.5;
        doc.setFont('helvetica', 'bold');
        doc.text('Subject: Dispute of Debt and Request for Verification', margin, yPosition);
        doc.setFont('helvetica', 'normal');
        // **5. Greeting**
        yPosition += lineHeight;
        const greeting = collectorName
            ? `Dear ${collectorName},`
            : 'Dear To Whom It May Concern,';
        doc.text(greeting, margin, yPosition);
        // **6. Body of the Letter**
        yPosition += lineHeight * 1.5;
        const firstParagraph = `I am writing in response to your communication regarding the above-referenced account. I am exercising my rights under the Fair Debt Collection Practices Act to dispute this debt and request verification. I dispute the validity of the debt in question for the following reason(s): ${reasonForDispute}.`;
        const firstParagraphLines = doc.splitTextToSize(firstParagraph, pageWidth - 2 * margin);
        doc.text(firstParagraphLines, margin, yPosition);
        yPosition += firstParagraphLines.length * lineHeight;
        const verificationRequest = `Under the Fair Debt Collection Practices Act (FDCPA), 15 U.S.C. § 1692g(b), I request that you provide verification of this debt. Specifically, please supply the following information:`;
        const verificationRequestLines = doc.splitTextToSize(verificationRequest, pageWidth - 2 * margin);
        doc.text(verificationRequestLines, margin, yPosition);
        yPosition += verificationRequestLines.length * lineHeight;
        const bulletPoints = [
            '1. The amount of the debt and an itemized accounting of any interest, fees, or other charges that have been added to the original amount.',
            '2. The name and address of the original creditor.',
            '3. A copy of any judgment (if applicable).',
            '4. Proof that you are licensed to collect debts in my state.',
            '5. Proof of the last payment made on this account.'
        ];
        bulletPoints.forEach(point => {
            const pointLines = doc.splitTextToSize(point, pageWidth - 2 * margin);
            doc.text(pointLines, margin + 5, yPosition); // Indent bullet points
            yPosition += pointLines.length * lineHeight;
        });
        const request30Days = `I request that you provide this information within 30 days of receiving this letter. Until this information is provided, I request that you cease all collection activities related to this debt. If you have reported this debt to any credit reporting agencies, I also demand that you inform them of this dispute in compliance with the Fair Credit Reporting Act, 15 U.S.C. § 1681s-2.`;
        const request30DaysLines = doc.splitTextToSize(request30Days, pageWidth - 2 * margin);
        doc.text(request30DaysLines, margin, yPosition);
        yPosition += request30DaysLines.length * lineHeight;
        const communicationPreference = `Please forward all written responses to both my email address (${email}) and my physical address as provided above. Please note that I prefer all future communications regarding this matter to be in writing.`;
        const communicationPreferenceLines = doc.splitTextToSize(communicationPreference, pageWidth - 2 * margin);
        doc.text(communicationPreferenceLines, margin, yPosition);
        yPosition += communicationPreferenceLines.length * lineHeight;
        const privacyRequest = `I do not authorize you to release any of my personal or financial information to any third party.`;
        const privacyRequestLines = doc.splitTextToSize(privacyRequest, pageWidth - 2 * margin);
        doc.text(privacyRequestLines, margin, yPosition);
        yPosition += privacyRequestLines.length * lineHeight;
        const finalStatement = `I am maintaining careful records of all correspondence and communications related to this matter, and I am prepared to report any violations of the FDCPA to the appropriate authorities, including the Federal Trade Commission and the Consumer Financial Protection Bureau.`;
        const finalStatementLines = doc.splitTextToSize(finalStatement, pageWidth - 2 * margin);
        doc.text(finalStatementLines, margin, yPosition);
        yPosition += finalStatementLines.length * lineHeight;
        if (disputeNote) {
            const disputeNoteLines = doc.splitTextToSize(disputeNote, pageWidth - 2 * margin);
            doc.text(disputeNoteLines, margin, yPosition);
            yPosition += disputeNoteLines.length * lineHeight;
        }
        // **7. Closing**
        yPosition += lineHeight * 1.5;
        doc.text('Sincerely,', margin, yPosition);
        yPosition += lineHeight * 1.5;
        doc.text(`${fullName}`, margin, yPosition);
        // **8. Footer**
        doc.setFontSize(10); // Increased font size
        doc.setTextColor(150);
        doc.text('Powered by DebtCat', margin, doc.internal.pageSize.getHeight() - 10);
        // **9. Finalize PDF**
        loadingModal.style.display = 'none';  
        doc.save('dispute_letter.pdf');
        window.location.href = '/ty-pdf';
    }, 3000); 
}
// PDF Generation Function for Email (Returns Blob)
async function generatePdfForEmail() {
    const { jsPDF } = window.jspdf;
    const doc = new jsPDF();
    const formData = JSON.parse(localStorage.getItem('submittedData'));
    const {
        firstName,
        lastName,
        email,
        address,
        city,
        state,
        zip,
        accountNumber,
        balance,
        collectorName,
        reasonForDispute,
        disputeNote
    } = formData || {};
    const fullName = `${firstName || ''} ${lastName || ''}`.trim();
    if (!fullName) {
        console.error("Full name is undefined");
    }
    const pageWidth = doc.internal.pageSize.getWidth();
    const margin = 20; // Increased margin to prevent text from touching the edges
    const lineHeight = 6; // Adjusted for better readability
    let yPosition = 20;
    // **1. Date**
    yPosition += lineHeight * 2; // Increased spacing at the top
    const currentDate = new Date().toLocaleDateString('en-US', {
        year: 'numeric',
        month: 'long',
        day: 'numeric'
    });
    doc.text(`${currentDate}`, margin, yPosition);
    // **2. Sender's Information**
    yPosition += lineHeight * 1.2;
    doc.setFontSize(12);
    doc.text(fullName, margin, yPosition);
    yPosition += lineHeight;
    const fullAddress = `${address}, ${city}, ${state} ${zip}`.trim();
    doc.text(fullAddress, margin, yPosition);
    yPosition += lineHeight;
    doc.text(`${email}`, margin, yPosition);
    // **3. Account Details**
    yPosition += lineHeight * 1.5;
    // Format the balance with commas and two decimal places
    const numericBalance = Number(balance);
    let formattedBalance = "0.00";
    if (!isNaN(numericBalance)) {
        formattedBalance = numericBalance.toLocaleString('en-US', {
            minimumFractionDigits: 2,
            maximumFractionDigits: 2
        });
    } else {
        console.error("Invalid balance value:", balance);
    }
    // Insert the account number and formatted balance into the PDF
    doc.text(`Account Number: ${accountNumber}`, margin, yPosition);
    yPosition += lineHeight;
    doc.text(`Account Balance: $${formattedBalance}`, margin, yPosition);
    // **4. Subject Line**
    yPosition += lineHeight * 1.5;
    doc.setFont('helvetica', 'bold');
    doc.text('Subject: Dispute of Debt and Request for Verification', margin, yPosition);
    doc.setFont('helvetica', 'normal');
    // **5. Greeting**
    yPosition += lineHeight;
    const greeting = collectorName
        ? `Dear ${collectorName},`
        : 'Dear To Whom It May Concern,';
    doc.text(greeting, margin, yPosition);
    // **6. Body of the Letter**
    yPosition += lineHeight * 1.5;
    const firstParagraph = `I am writing in response to your communication regarding the above-referenced account. I am exercising my rights under the Fair Debt Collection Practices Act to dispute this debt and request verification. I dispute the validity of the debt in question for the following reason(s): ${reasonForDispute}.`;
    const firstParagraphLines = doc.splitTextToSize(firstParagraph, pageWidth - 2 * margin);
    doc.text(firstParagraphLines, margin, yPosition);
    yPosition += firstParagraphLines.length * lineHeight;
    const verificationRequest = `Under the Fair Debt Collection Practices Act (FDCPA), 15 U.S.C. § 1692g(b), I request that you provide verification of this debt. Specifically, please supply the following information:`;
    const verificationRequestLines = doc.splitTextToSize(verificationRequest, pageWidth - 2 * margin);
    doc.text(verificationRequestLines, margin, yPosition);
    yPosition += verificationRequestLines.length * lineHeight;
    const bulletPoints = [
        '1. The amount of the debt and an itemized accounting of any interest, fees, or other charges that have been added to the original amount.',
        '2. The name and address of the original creditor.',
        '3. A copy of any judgment (if applicable).',
        '4. Proof that you are licensed to collect debts in my state.',
        '5. Proof of the last payment made on this account.'
    ];
    bulletPoints.forEach(point => {
        const pointLines = doc.splitTextToSize(point, pageWidth - 2 * margin);
        doc.text(pointLines, margin + 5, yPosition); // Indent bullet points
        yPosition += pointLines.length * lineHeight;
    });
    const request30Days = `I request that you provide this information within 30 days of receiving this letter. Until this information is provided, I request that you cease all collection activities related to this debt. If you have reported this debt to any credit reporting agencies, I also demand that you inform them of this dispute in compliance with the Fair Credit Reporting Act, 15 U.S.C. § 1681s-2.`;
    const request30DaysLines = doc.splitTextToSize(request30Days, pageWidth - 2 * margin);
    doc.text(request30DaysLines, margin, yPosition);
    yPosition += request30DaysLines.length * lineHeight;
    const communicationPreference = `Please forward all written responses to both my email address (${email}) and my physical address as provided above. Please note that I prefer all future communications regarding this matter to be in writing.`;
    const communicationPreferenceLines = doc.splitTextToSize(communicationPreference, pageWidth - 2 * margin);
    doc.text(communicationPreferenceLines, margin, yPosition);
    yPosition += communicationPreferenceLines.length * lineHeight;
    const privacyRequest = `I do not authorize you to release any of my personal or financial information to any third party.`;
    const privacyRequestLines = doc.splitTextToSize(privacyRequest, pageWidth - 2 * margin);
    doc.text(privacyRequestLines, margin, yPosition);
    yPosition += privacyRequestLines.length * lineHeight;
    const finalStatement = `I am maintaining careful records of all correspondence and communications related to this matter, and I am prepared to report any violations of the FDCPA to the appropriate authorities, including the Federal Trade Commission and the Consumer Financial Protection Bureau.`;
    const finalStatementLines = doc.splitTextToSize(finalStatement, pageWidth - 2 * margin);
    doc.text(finalStatementLines, margin, yPosition);
    yPosition += finalStatementLines.length * lineHeight;
    if (disputeNote) {
        const disputeNoteLines = doc.splitTextToSize(disputeNote, pageWidth - 2 * margin);
        doc.text(disputeNoteLines, margin, yPosition);
        yPosition += disputeNoteLines.length * lineHeight;
    }
    // **7. Closing**
    yPosition += lineHeight * 1.5;
    doc.text('Sincerely,', margin, yPosition);
    yPosition += lineHeight * 1.5;
    doc.text(`${fullName}`, margin, yPosition);
    // **8. Footer**
    doc.setFontSize(10); // Increased font size
    doc.setTextColor(150);
    doc.text('Powered by DebtCat', margin, doc.internal.pageSize.getHeight() - 10);
    // **9. Finalize PDF for Email**
    const pdfBlob = doc.output('blob');
    return pdfBlob;
}
// Modified Send Email Function
async function sendEmail() {
    if (!rateLimiter()) return;
    const submitButton = document.getElementById('submitEmailButton');
    const loadingIndicator = document.getElementById('loadingIndicator');
    submitButton.style.display = 'none';
    loadingIndicator.style.display = 'block';
    try {
        const email = document.getElementById('emailAddress').value.trim();
        const formData = JSON.parse(localStorage.getItem('submittedData'));
        // Generate PDF Blob
        const pdfBlob = await generatePdfForEmail();
        // Convert PDF Blob to Base64
        const base64Pdf = await blobToBase64(pdfBlob);
        // Prepare Payload
        const payload = {
            email: email,
            pdfData: base64Pdf,
            filename: 'dispute_letter.pdf',
            formData: formData
        };
        // Send to Cloudflare Worker
        const response = await fetch('https://sendgrid-pdf-v1.debtcatai.workers.dev/', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(payload)
        });
        const data = await response.json();
        if (!data.success) {
            throw new Error(data.message || 'Email sending failed.');
        }
        window.location.href = "/ty-email-myself";
    } catch (error) {
        console.error('Error sending email:', error);
        alert(error.message || 'An error occurred while sending the email.');
        submitButton.style.display = 'block';
    } finally {
        loadingIndicator.style.display = 'none';
    }
}
// Event listener for "Download PDF" button
document.getElementById('downloadDisputeButton').addEventListener('click', function() {
    generatePdf();
});
// Function to load Turnstile script
function loadTurnstileScript() {
    if (!document.getElementById('turnstileScript')) {
        const script = document.createElement('script');
        script.src = "https://challenges.cloudflare.com/turnstile/v0/api.js?render=explicit";
        script.async = true;
        script.defer = true;
        script.id = 'turnstileScript';
        script.onload = () => {
            console.log('Turnstile script loaded.');
            loadCaptcha();
        };
        script.onerror = () => {
            console.error('Failed to load Turnstile script.');
            handleCaptchaError('Failed to load CAPTCHA script. Please refresh the page and try again.');
        };
        document.body.appendChild(script);
    } else {
        console.log('Turnstile script already loaded.');
        loadCaptcha();
    }
}
// Event listeners
document.addEventListener('DOMContentLoaded', () => {
    document.getElementById('emailDisputeButton').addEventListener('click', async function() {
        const emailInputSection = document.getElementById('emailInputSection');
        const emailField = document.getElementById('emailAddress');
        if (!emailInputSection.classList.contains('expanded')) {
            emailInputSection.classList.add('expanded');
            emailInputSection.style.display = 'block';
            this.classList.add('email-card-expanded');
            if (!emailPopulated && emailField.value === '') {
                try {
                    const formData = JSON.parse(localStorage.getItem('submittedData'));
                    if (formData && formData.email) {
                        emailField.value = formData.email;
                        emailPopulated = true;
                    }
                } catch (error) {
                    console.error("Error parsing JSON from localStorage:", error);
                    alert("There was an error processing your data. Please try again.");
                    return;
                }
            }
            try {
                await loadTurnstileScript();
                await loadCaptcha();
            } catch (error) {
                console.error('Error loading CAPTCHA:', error);
                handleCaptchaError('Failed to load CAPTCHA. Please refresh the page and try again.');
            }
        }
    });
    function updateSubmittedData(letterType) {
        try {
            let submittedData = JSON.parse(localStorage.getItem('submittedData')) || {};
            submittedData.letterType = letterType;
            localStorage.setItem('submittedData', JSON.stringify(submittedData));
        } catch (error) {
            console.error("Error updating submittedData:", error);
        }
    }
    document.getElementById('firstClassMailButton').addEventListener('click', function() {
        updateSubmittedData('first_class');
        window.location.href = '/collector-info';
    });
    document.getElementById('certifiedMailButton').addEventListener('click', function() {
        updateSubmittedData('certified');
        window.location.href = '/collector-info';
    });
    document.getElementById('emailAddress').addEventListener('input', validateForm);
    document.getElementById('saveEmail').addEventListener('change', validateForm);
    document.getElementById('submitEmailButton').addEventListener('click', sendEmail);
});
</script>
          </body>
          </html>
        </div>
      </section>
    </div>
    <main class="footer">
      <div class="container-2">
        <div class="footer-wrapper-three">
          <div class="footer-block-three">
            <a href="../start-dispute.html" class="footer-link-three">Dispute</a>
            <a href="../articles.html" class="footer-link-three">Guides</a>
            <a href="../chat.html" class="footer-link-three">Debt Chat</a>
            <a href="../s/about.html" class="footer-link-three">About Us</a>
            <a href="https://www.debtcat.com/s/fdcpa-checklist" class="footer-link-three">FDCPA Checklist</a>
          </div>
          <div class="footer-social-block">
            <a href="https://www.instagram.com/debtcat/" class="footer-social-link w-inline-block">
              <div class="footer-icon"></div>
            </a>
            <a href="https://www.threads.net/@debtcat" class="footer-social-link w-inline-block">
              <div class="footer-icon"></div>
            </a>
            <a href="https://x.com/DebtCatAI" class="footer-social-link w-inline-block">
              <div class="footer-icon"></div>
            </a>
            <a href="https://www.facebook.com/profile.php?id=61564070911067" class="footer-social-link w-inline-block">
              <div class="footer-icon"></div>
            </a>
            <a href="https://www.tiktok.com/@debtcat" class="footer-social-link w-inline-block">
              <div class="footer-icon"></div>
            </a>
            <a href="https://www.youtube.com/@DebtCat" class="footer-social-link w-inline-block">
              <div class="footer-icon"></div>
            </a>
          </div>
        </div>
        <div class="footer-divider-two"></div>
        <div class="footer-bottom">
          <div class="footer-copyright">© 2025 DebtCat. All rights reserved | Developed and authored with AI assistance ✨   <br></div>
          <div class="footer-legal-block">
            <a href="../s/tos.html" target="_blank" class="footer-legal-link">Terms Of Service</a>
            <a href="../s/refund.html" target="_blank" class="footer-legal-link">Refund Policy</a>
            <a href="../s/privacy-policy.html" target="_blank" class="footer-legal-link">Privacy Policy</a>
          </div>
        </div>
      </div>
    </main>
  </div>
  <script src="https://d3e54v103j8qbb.cloudfront.net/js/jquery-3.5.1.min.dc5e7f18c8.js?site=66567a3f3727972f31237c21" type="text/javascript" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
  <script src="../js/webflow.js" type="text/javascript"></script>
</body>
</html>