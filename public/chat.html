<!DOCTYPE html><!--  Last Published: Thu Feb 06 2025 20:19:31 GMT+0000 (Coordinated Universal Time)  -->
<html data-wf-page="665fb3fc5a0c17b677cf2803" data-wf-site="66567a3f3727972f31237c21">
<head>
  <meta charset="utf-8">
  <title>DebtCat | Chat</title>
  <meta content="Chat with DebtCat&#x27;s AI bot for personalized debt advice. Download your chat transcript or email it for easy reference and take control of your finances." name="description">
  <meta content="DebtCat | Chat" property="og:title">
  <meta content="Chat with DebtCat&#x27;s AI bot for personalized debt advice. Download your chat transcript or email it for easy reference and take control of your finances." property="og:description">
  <meta content="DebtCat | Chat" property="twitter:title">
  <meta content="Chat with DebtCat&#x27;s AI bot for personalized debt advice. Download your chat transcript or email it for easy reference and take control of your finances." property="twitter:description">
  <meta property="og:type" content="website">
  <meta content="summary_large_image" name="twitter:card">
  <meta content="width=device-width, initial-scale=1" name="viewport">
  <meta content="6e09m7Tfl6u4e-eTXMXpwCbUlW_YC8oVpyv0EL-XU9k" name="google-site-verification">
  <link href="css/normalize.css" rel="stylesheet" type="text/css">
  <link href="css/webflow.css" rel="stylesheet" type="text/css">
  <link href="css/debtcat.webflow.css" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com" rel="preconnect">
  <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin="anonymous">
  <script src="https://ajax.googleapis.com/ajax/libs/webfont/1.6.26/webfont.js" type="text/javascript"></script>
  <script type="text/javascript">WebFont.load({  google: {    families: ["Montserrat:100,100italic,200,200italic,300,300italic,400,400italic,500,500italic,600,600italic,700,700italic,800,800italic,900,900italic","Merriweather:300,300italic,400,400italic,700,700italic,900,900italic","Roboto:100,300,regular,500,700,900"]  }});</script>
  <script type="text/javascript">!function(o,c){var n=c.documentElement,t=" w-mod-";n.className+=t+"js",("ontouchstart"in o||o.DocumentTouch&&c instanceof DocumentTouch)&&(n.className+=t+"touch")}(window,document);</script>
  <link href="images/favicon.png" rel="shortcut icon" type="image/x-icon">
  <link href="images/webclip.png" rel="apple-touch-icon">
  <script async="" src="https://www.googletagmanager.com/gtag/js?id=G-DMRMQNLTBZ"></script>
  <script type="text/javascript">window.dataLayer = window.dataLayer || [];function gtag(){dataLayer.push(arguments);}gtag('js', new Date());gtag('set', 'developer_id.dZGVlNj', true);gtag('config', 'G-DMRMQNLTBZ');</script><!--  Google tag (gtag.js) ** MOVED to site settings/integrations"
<script async src="https://www.googletagmanager.com/gtag/js?id=G-DMRMQNLTBZ"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-DMRMQNLTBZ');
</script>   -->
  <!--   MS Clarity   -->
  <script type="text/javascript">
    (function(c,l,a,r,i,t,y){
        c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)};
        t=l.createElement(r);t.async=1;t.src="https://www.clarity.ms/tag/"+i;
        y=l.getElementsByTagName(r)[0];y.parentNode.insertBefore(t,y);
    })(window, document, "clarity", "script", "oc17kv2js6");
</script>
  <script>
  // Define the getIP function before loading the ipify script
  function getIP(json) {
    userIP = json.ip;
  }
  // Initialize the userIP variable
  let userIP = '';
</script>
  <script src="https://api.ipify.org?format=jsonp&callback=getIP"></script>
  <link rel="stylesheet" href="https://unpkg.com/@geoapify/geocoder-autocomplete@^1/styles/minimal.css">
</head>
<body>
  <div class="w-layout-blockcontainer container-body w-container">
    <div class="navbar">
      <div data-animation="default" data-collapse="medium" data-duration="400" data-easing="ease" data-easing2="ease" role="banner" class="navbar-no-shadow-container w-nav">
        <div class="container-regular">
          <div class="navbar-wrapper">
            <a href="index.html" class="navbar-brand w-nav-brand"><img src="images/debtcat-logo-inverse.svg" loading="lazy" width="70" height="Auto" alt="DebtCat logo" class="logo-header"></a>
            <nav role="navigation" class="nav-menu-wrapper w-nav-menu">
              <ul role="list" class="nav-menu w-list-unstyled">
                <li class="list-item">
                  <a href="start-dispute.html" class="nav-link h4-montserrat-navbar">Dispute</a>
                </li>
                <li class="list-item">
                  <a href="chat.html" aria-current="page" class="nav-link h4-montserrat-navbar w--current">Chat</a>
                </li>
                <li class="list-item">
                  <a href="articles.html" class="nav-link h4-montserrat-navbar">Guides</a>
                </li>
                <li class="list-item">
                  <a href="s/about.html" class="nav-link h4-montserrat-navbar">About Us</a>
                </li>
              </ul>
            </nav>
            <address class="menu-button w-nav-button">
              <div class="icon w-icon-nav-menu"></div>
            </address>
          </div>
        </div>
      </div>
    </div>
    <div class="w-layout-blockcontainer content-container w-container">
      <div class="w-embed w-script"><!--  Taboola Pixel Code  -->
        <script type="text/javascript">
  window._tfa = window._tfa || [];
  window._tfa.push({notify: 'event', name: 'page_view', id: 1796097});
  !function (t, f, a, x) {
         if (!document.getElementById(x)) {
            t.async = 1;t.src = a;t.id=x;f.parentNode.insertBefore(t, f);
         }
  }(document.createElement('script'),
  document.getElementsByTagName('script')[0],
  '//cdn.taboola.com/libtrc/unip/1796097/tfa.js',
  'tb_tfa_script');
</script>
        <!--  End of Taboola Pixel Code  -->
        <!DOCTYPE html>
        <html lang="en">
        <head>
          <meta charset="UTF-8">
          <meta name="viewport" content="width=device-width, initial-scale=1.0">
          <title>DebtChat</title>
          <style>
     /* Reset and Base Styles */
* {
    box-sizing: border-box;
    margin: 0;
    padding: 0;
}
body, html {
    height: 100%;
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
    font-size: 16px;
    line-height: 1.5;
    color: #333;
    background-color: #FFFFFF;
}
#app-container {
    display: flex;
    flex-direction: column;
    align-items: center;
    background-color: #ffffff;
    padding: 10px;
    border-radius: 16px;
    box-shadow: 0 0 20px rgba(0, 0, 0, 0.1);
    width: 100%;
    max-width: 600px;
    margin: 0 auto;
    position: relative;
    height: 100vh;
    overflow: hidden;
    z-index: 1;
}
#chat-header {
    width: 100%;
    text-align: center;
    padding: 15px 0;
    background-color: #FFFFFF;
    border-bottom: 1px solid #E0E0E0;
    position: sticky;
    top: 0;
    z-index: 13;
    display: flex;
    align-items: center;
    justify-content: center;
}
#chat-header h2 {
    font-family: 'Montserrat', sans-serif;
    font-size: 24px;
    font-weight: 600;
    color: #333;
    margin: 0;
}
#chat-header img {
    width: 30px;
    height: auto;
    margin-right: 10px;
}
/* Hide the top disclaimer in the UI */
#disclaimer {
    display: none;
}
#chat-container {
    flex-grow: 1;
    overflow-y: auto;
    padding: 15px;
    background-color: #FFFFFF; 
    padding-bottom: 100px; 
    position: relative;
    width: 100%;
    max-width: 600px;
    margin: 0 auto;
}
/* Message Container Styles */
.message-container {
    display: flex;
    width: 100%;
    margin-bottom: 10px;
}
.message-container.me {
    justify-content: flex-end;
}
.message-container.debtchat {
    justify-content: flex-start;
}
.message {
    padding: 10px 15px;
    border-radius: 20px;
    word-wrap: break-word;
    max-width: 80%; /* Adjust as needed */
    text-align: left;
    background-color: #f1f1f1;
    color: #333;
}
.message.me {
    background-color: #3358EF;
    color: white;
}
.message.debtchat {
    background-color: #f1f1f1;
    color: #333;
}
/* Download Button Styles */
#fixed-download-button {
    position: absolute;
    bottom: 100%; 
    right: 0;
    margin-bottom: 10px;
    width: 52px;
    height: 52px;
    background-color: transparent;
    border: none;
    cursor: pointer;
    z-index: 102;
    display: flex;
    align-items: center;
    justify-content: center;
}
/*  styles for the disabled state */
#fixed-download-button:disabled {
    opacity: 0.5;
    cursor: not-allowed;
}
/*  adjust the image inside the disabled button */
#fixed-download-button:disabled img {
    opacity: 0.5;
}
#fixed-download-button img {
    width: 100%;
    height: 100%;
    object-fit: contain;
}
/* Input Area Styles */
#input-area {
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 10px;
    background-color: #FFFFFF;
    position: fixed;
    bottom: 0;
    left: 50%;
    transform: translateX(-50%);
    z-index: 100;
    max-width: 600px;
    width: 90%;
}
#input-row {
    display: flex;
    align-items: center;
    position: relative;
    width: 100%;
}
#user-input {
    flex-grow: 1;
    padding: 12px 50px 12px 15px;
    border: 1px solid #ccc;
    border-radius: 25px;
    font-size: 1rem;
    resize: none;
    height: 50px;
    max-width: 100%;
    text-align: left;
    box-sizing: border-box;
}
#send-button {
    position: absolute;
    right: 10px;
    top: 50%;
    transform: translateY(-50%);
    width: 32px;
    height: 32px;
    background: url("https://cdn.prod.website-files.com/66567a3f3727972f31237c21/66dfc1c913442304bb5b25b4_submit.svg") no-repeat center;
    background-size: contain;
    border: none;
    z-index: 101;
    cursor: pointer;
    display: block;
}
#send-button:enabled:hover,
#send-button:enabled:active {
    background-color: rgba(255, 255, 255, 0.5);
}
#send-button:disabled {
    opacity: 0.5;
    pointer-events: none;
    cursor: not-allowed;
}
/* Disclaimer under the input area */
#disclaimer-ui {
    font-family: 'Roboto', sans-serif;  
    font-weight: 400; 
    font-size: 12px;
    color: #79798B;  
    padding: 5px 10px;
    text-align: center;
    margin-top: 5px;
    margin-bottom: 0; 
    width: 100%;
}
/* Modal Styles */
.modal {
    display: none; /* Hide modals by default */
    justify-content: center;
    align-items: center;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(255, 255, 255, 0.8);
    z-index: 2000;
}
.modal-content {
    background-color: white;
    padding: 30px;
    border-radius: 12px;
    width: 90%;
    max-width: 400px;
    text-align: center;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    position: relative;
    border: 1px solid #1A1A1E;
}
/* Additional Styles for Modals, Loading Indicators, etc. */
#download-modal h2 {
    font-family: 'Montserrat', sans-serif;
    font-size: 20px;
    font-weight: 600;
    margin-bottom: 25px;
    color: #333;
}
#download-modal .modal-buttons {
    display: flex;
    justify-content: space-between;
    gap: 20px;
}
#download-modal .modal-buttons button {
    flex: 1;
    padding: 15px;
    border: 3px solid #333;
    border-radius: 8px;
    font-family: 'Roboto', sans-serif;
    font-size: 16px;
    font-weight: 600;
    cursor: pointer;
    background-color: white;
    transition: background-color 0.3s ease, transform 0.1s ease, box-shadow 0.1s ease;
    box-shadow: 2px 2px 0px black;
}
#download-modal .modal-buttons button:hover {
    background-color: #CBF84C;
    box-shadow: none;
}
#download-modal .modal-buttons button:active {
    transform: scale(0.95);
}
#download-modal .close-button {
    position: absolute;
    top: 3px; 
    right: 10px; 
    background: none;
    border: none;
    font-size: 28px;
    cursor: pointer;
    color: #333;
}
#email-input {
    display: none;
    flex-direction: column;
    margin-top: 25px;
    text-align: left;
    align-items: center;
}
#email-input input[type="email"] {
    width: 100%;
    padding: 10px;
    margin-bottom: 10px;
    border-radius: 5px;
    border: 1px solid #ccc;
}
#email-input label {
    display: flex;
    align-items: flex-start;
    font-size: 0.7rem;
    margin-bottom: 10px;
    line-height: 1.2;
}
#email-input label input[type="checkbox"] {
    margin-right: 10px;
    margin-top: 2px;
    transform: scale(1.5);
}
#email-input label span {
    flex: 1;
    text-align: left;
}
#email-input button {
    width: 100%;
    padding: 10px;
    background-color: #3358EF;
    color: white;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    transition: background-color 0.3s ease, transform 0.1s ease;
    margin-top: 18px;
}
#email-input button:hover {
    background-color: #284dbf;
}
#email-input button:active {
    transform: scale(0.95);
}
#email-input button:disabled {
    background-color: #ccc;
    cursor: not-allowed;
    opacity: 0.6;
}
#email-input label a {
    color: #3358EF;
    text-decoration: none;
}
#email-input label a:hover {
    text-decoration: underline;
}
/* Loading indicators */
.loading {
    display: flex;
    align-items: center;
    justify-content: flex-start;
    padding: 10px 15px;
    margin-bottom: 10px;
    z-index: 1000;
}
.loading-dot {
    width: 8px;
    height: 8px;
    background-color: #3358EF;
    border-radius: 50%;
    margin-right: 5px;
    animation: pulse 1.5s infinite ease-in-out;
}
.loading-dot:nth-child(2) {
    animation-delay: 0.5s;
}
.loading-dot:nth-child(3) {
    animation-delay: 1s;
}
@keyframes pulse {
    0%, 100% { transform: scale(0.8); opacity: 0.5; }
    50% { transform: scale(1.2); opacity: 1; }
}
.spinner {
    width: 56px;
    height: 56px;
    border-radius: 50%;
    background: radial-gradient(farthest-side, #3358ef 94%, transparent) top/9px 9px no-repeat,
    conic-gradient(transparent 30%, #3358ef);
    -webkit-mask: radial-gradient(farthest-side, transparent calc(100% - 9px), #000 0);
    animation: spinner-c7wet2 1s infinite linear;
    margin: 0 auto;
    z-index: 5000;
}
@keyframes spinner-c7wet2 {
    100% {
        transform: rotate(1turn);
    }
}
@media (max-width: 600px) {
    #input-area {
        width: 100%;
        left: 0;
        transform: none;
    }
    #fixed-download-button {
        right: 10px;
    }
}
    #fixed-download-button {
        right: 10px;
    }
}
    /* Chat Page Responsive Design */
@media (min-width: 992px) {
    #app-container {
        max-width: 800px;
        height: calc(100vh - 100px);
        border: 1px solid #E0E0E0;
    }
    
    #chat-container {
        max-width: 800px;
    }
    
    .message {
        max-width: 70%;
    }
}

@media (max-width: 991px) {
    #app-container {
        max-width: 600px;
    }
    
    #chat-container {
        max-width: 600px;
    }
}

/* Preserve mobile view */
@media (max-width: 767px) {
    #app-container {
        height: 100vh;
        max-width: 100%;
        border-radius: 16px;
        box-shadow: 0 0 20px rgba(0, 0, 0, 0.2);
        padding: 5px;
        border: none;
    }
    
    #chat-container {
        padding: 10px;
    }
    
    .message {
        max-width: 85%;
    }
}   
    </style>
        </head>
        <body>
          <div id="app-container">
            <!--  Header  -->
            <header id="chat-header">
              <img src="images/debtcat-logo-inverse.svg" alt="DebtCat logo">
              <h2>DebtChat</h2>
            </header>
            <main id="chat-container">
              <div id="disclaimer">
                Not financial advice. DebtChat can make mistakes. Verify important info.
              </div>
              <div id="chat-messages" role="log" aria-live="polite">
              </div>
            </main>
            <!--  Input Area  -->
            <footer id="input-area">
              <!--  Download Button  -->
              <button id="fixed-download-button" aria-label="Download chat" disabled="">
                <img src="images/ico--download-chat.svg" alt="Download icon">
              </button>
              <div id="input-row">
                <textarea id="user-input" placeholder="Ask DebtChat anything..." aria-label="User input" rows="1"></textarea>
                <button id="send-button" aria-label="Send message" disabled=""></button>
              </div>
              <div id="disclaimer-ui">
                DebtChat can make mistakes, check important info.
              </div>
            </footer>
          </div>
          <!--  Download Modal  -->
          <div id="download-modal" class="modal">
            <div class="modal-content">
              <button class="close-button" aria-label="Close">&times;</button>
              <h2>How do you want your transcript?</h2>
              <div class="modal-buttons">
                <button id="modal-download-pdf">PDF</button>
                <button id="modal-mail">Email Myself</button>
              </div>
              <div id="email-input">
                <input type="email" id="email-address" placeholder="Enter your email" aria-label="Email address">
                <label>
                  <input type="checkbox" id="save-email">
                  <span>By submitting, I agree to the <a href="/tos" target="_blank">Terms</a> and <a href="/privacy-policy" target="_blank">Privacy Policy</a>.</span>
                </label>
                <button id="submit-email" disabled="">Send Email</button>
                <div id="loadingIndicator" class="spinner" style="display: none;"></div>
              </div>
            </div>
          </div>
          <!--  Loading Modal  -->
          <div id="loadingModal" class="modal">
            <div class="modal-content">
              <div class="spinner"></div>
              <h4><br>Loading, please wait...</h4>
            </div>
          </div>
          <!--  CAPTCHA Modal  -->
          <div id="captchaModal" class="modal">
            <div class="modal-content">
              <h4>Prove you're human to start the chat!</h4>
              <div id="captchaContainer"></div>
            </div>
          </div>
          <!--  Include jsPDF library  -->
          <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.4.0/jspdf.umd.min.js"></script>
          <script src="https://challenges.cloudflare.com/turnstile/v0/api.js" async="" defer=""></script>
          <script>
    // Function to get user's IP address
    async function getUserIP() {
        const response = await fetch('https://api.ipify.org?format=json');
        const data = await response.json();
        return data.ip;
    }
// Function to sanitize the AI's response by removing any HTML tags
function sanitizeResponse(response) {
    // Remove any HTML tags and their contents
    return response.replace(/<[^>]*>?/gm, '');
}
    // Function to log page visit
    async function logPageVisit() {
        const timestamp = new Date().toISOString();
        const ip = await getUserIP();
        const userAgent = navigator.userAgent;
        const payload = {
            timestamp: timestamp,
            ip: ip,
            userAgent: userAgent,
            email: ''  // No email on landing, so leave blank
        };
        // Send the data to the Worker
        fetch('https://glog-cht-eml.debtcatai.workers.dev/', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(payload)
        });
    }
    // Function to validate the email form
    function validateForm() {
        const email = document.getElementById('email-address').value.trim();
        const isEmailValid = /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);  // Email validation regex
        const isCheckboxChecked = document.getElementById('save-email').checked;
        // Enable the submit button only if email is valid and checkbox is checked
        const submitButton = document.getElementById('submit-email');
        submitButton.disabled = !(isEmailValid && isCheckboxChecked);
    }
    // Function to create a spinner (if needed)
    const createSpinner = (size = 'large') => {
        const spinner = document.createElement('div');
        spinner.className = size === 'large' ? 'spinner' : 'spinner-small';
        spinner.style.display = 'block';
        spinner.style.margin = 'auto';
        return spinner;
    };
    // Call the function when the DOM is fully loaded
    document.addEventListener('DOMContentLoaded', function() {
        logPageVisit();
        const chatMessages = document.getElementById('chat-messages');
        const userInput = document.getElementById('user-input');
        const sendButton = document.getElementById('send-button');
        const fixedDownloadButton = document.getElementById('fixed-download-button');
        const downloadModal = document.getElementById('download-modal');
        const modalDownloadPdfButton = document.getElementById('modal-download-pdf');
        const modalMailButton = document.getElementById('modal-mail');
        const emailInputSection = document.getElementById('email-input');
        const emailSubmitButton = document.getElementById('submit-email');
        const modalCloseButton = document.querySelector('.close-button');
        const saveEmailCheckbox = document.getElementById('save-email');
        const emailInput = document.getElementById('email-address');
        const chatContainer = document.getElementById('chat-container');
        const loadingModal = document.getElementById('loadingModal');
        let conversationHistory = [];
        // Add event listeners
        sendButton.addEventListener('click', sendMessage);
        userInput.addEventListener('input', adjustTextarea);
        userInput.addEventListener('keypress', handleEnterPress);
        fixedDownloadButton.addEventListener('click', () => { downloadModal.style.display = 'flex'; });
        modalDownloadPdfButton.addEventListener('click', downloadChatLog);
        modalMailButton.addEventListener('click', () => { emailInputSection.style.display = 'block'; });
        emailSubmitButton.addEventListener('click', sendEmail);
        modalCloseButton.addEventListener('click', closeModal);
        emailInput.addEventListener('input', validateForm);
        saveEmailCheckbox.addEventListener('change', validateForm);
        function closeModal() {
            // Hide the download modal
            downloadModal.style.display = 'none';
            // Hide the email input section (in case it's visible)
            emailInputSection.style.display = 'none';
        }
        // Function to adjust the textarea size
        function adjustTextarea() {
            userInput.style.height = 'auto';
            userInput.style.height = (userInput.scrollHeight) + 'px';
            // Enable/disable send button based on input content
            if (userInput.value.trim()) {
                sendButton.disabled = false;  // Enable the button when there's input
            } else {
                sendButton.disabled = true;  // Disable the button when the input is empty
            }
        }
        // Function to handle enter key press
        function handleEnterPress(e) {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                sendMessage();
            }
        }
        // Function to display messages
        function displayMessage(sender, message) {
            const messageContainer = document.createElement('div');
            messageContainer.classList.add('message-container', sender);
            const messageElement = document.createElement('div');
            messageElement.classList.add('message', sender);
            messageElement.innerHTML = message;
            messageContainer.appendChild(messageElement);
            chatMessages.appendChild(messageContainer);
            scrollChatToBottom();
        }
        // Function to scroll chat to bottom
        function scrollChatToBottom() {
            chatContainer.scrollTop = chatContainer.scrollHeight;
        }
        // Function to display loading indicator
        function displayLoading() {
            const loadingElement = document.createElement('div');
            loadingElement.classList.add('loading');
            loadingElement.innerHTML = '<div class="loading-dot"></div><div class="loading-dot"></div><div class="loading-dot"></div>';
            chatMessages.appendChild(loadingElement);
            scrollChatToBottom();
            return loadingElement;
        }
        // Function to send message
        let messageCounter = 0;
        let captchaValidated = false; // Initial state: CAPTCHA not validated
        function sendMessage() {
            const message = userInput.value.trim(); // Get the message from the input
            // Check if CAPTCHA is needed (on the first message or every 10th message)
            messageCounter++;
            if (!captchaValidated && (messageCounter === 1 || messageCounter % 10 === 0)) {
                openCaptchaModal();  // Open CAPTCHA modal
                return;  // Stop further execution until CAPTCHA is validated
            }
            if (message) {
                // Disable the send button immediately after message is sent
                sendButton.disabled = true;
                displayMessage('me', message);  // Display the user's message in the chat
                conversationHistory.push({ role: 'user', content: message });  // Add to conversation history
                sendToAI(message);  // Call the AI function after CAPTCHA validation
                userInput.value = '';  // Clear the input field
                adjustTextarea();  // Adjust the input field size
            }
        }
        async function sendToAI(message) {
    const loadingElement = displayLoading();  // Show loading indicator while AI processes the request
    try {
        const response = await fetch('https://chatgpt-integration.debtcatai.workers.dev', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ message, conversationHistory })
        });
        if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
        const data = await response.json();
        loadingElement.remove();  // Remove the loading indicator after receiving response
        // **Step 1: Sanitize the response**
        let cleanedResponse = sanitizeResponse(data.response);
        // **Step 2: Replace URLs with anchor tags**
        const urlPattern = /https:\/\/(?:www\.)?debtcat\.com[^\s"'<>()\[\]]*/gi;
        cleanedResponse = cleanedResponse.replace(urlPattern, (match) => {
            if (/<a\s+href=/.test(match)) return match; // Skip if already an anchor tag
            const cleanUrl = match.replace(/[\s"'<>()\[\].,!?]*$/, '');
            return `<a href="${cleanUrl}" target="_blank" rel="noopener noreferrer">${cleanUrl}</a>`;
        });
        displayMessage('debtchat', cleanedResponse);  // Display AI's response in the chat
        conversationHistory.push({ role: 'assistant', content: cleanedResponse });
        // Enable the download button after the first AI response
        fixedDownloadButton.disabled = false;
    } catch (error) {
        console.error('Error:', error);
        loadingElement.remove();  // Remove the loading indicator in case of error
        displayMessage('debtchat', 'Sorry, I encountered an error. Please try again.');
        // Re-enable the send button in case of an error
        sendButton.disabled = false;
    }
}
        // Function to load CAPTCHA
        function loadCaptcha() {
            let captchaLoaded = false;
            // Start a timer to retry loading CAPTCHA after 5 seconds
            const retryTimeout = setTimeout(() => {
                if (!captchaLoaded) {
                    console.log("CAPTCHA not loaded in 5 seconds, retrying...");
                    // Remove existing CAPTCHA if any
                    const captchaContainer = document.getElementById('captchaContainer');
                    captchaContainer.innerHTML = '';
                    // Attempt to reload the CAPTCHA
                    loadCaptcha();  // Recursive call to reload
                }
            }, 5000);
            // Start another timer to prompt the user after 10 seconds
            const refreshTimeout = setTimeout(() => {
                if (!captchaLoaded) {
                    console.log("CAPTCHA not loaded in 10 seconds, prompting user to refresh.");
                    alert("There was an issue loading the CAPTCHA. Please refresh the page and try again.");
                }
            }, 10000);
            if (typeof turnstile !== 'undefined') {
                turnstile.render('#captchaContainer', {
                    sitekey: '0x4AAAAAAAiA6_L9K0nk7Zwy',  // Replace with your actual site key
                    callback: function(token) {
                        console.log("CAPTCHA completed successfully.");
                        captchaValidated = true;
                        captchaLoaded = true;
                        clearTimeout(retryTimeout);
                        clearTimeout(refreshTimeout);
                        closeCaptchaModal();  // Close the CAPTCHA modal
                        const loadingModal = document.getElementById('loadingModal');
                        loadingModal.style.display = 'none';  // Hide loading spinner
                        sendMessage();  // Send the user's message
                    },
                    'error-callback': function() {
                        console.log("CAPTCHA failed.");
                        captchaValidated = false;
                        captchaLoaded = true;  // Consider it loaded even if it failed
                        clearTimeout(retryTimeout);
                        clearTimeout(refreshTimeout);
                        const loadingModal = document.getElementById('loadingModal');
                        loadingModal.style.display = 'none';  // Hide loading spinner
                    }
                });
            } else {
                console.error('Turnstile is not available.');
                captchaLoaded = true;  // Since we know it won't load
                clearTimeout(retryTimeout);
                clearTimeout(refreshTimeout);
                const loadingModal = document.getElementById('loadingModal');
                loadingModal.style.display = 'none';  // Hide loading spinner
            }
        }
        // Function to open CAPTCHA modal
        function openCaptchaModal() {
            const captchaModal = document.getElementById('captchaModal');
            const loadingModal = document.getElementById('loadingModal');
            captchaModal.style.display = 'flex';  // Show CAPTCHA modal
            loadingModal.style.display = 'flex';  // Show loading spinner
            loadCaptcha();  // Load CAPTCHA into the container
        }
        // Function to close the CAPTCHA modal
        function closeCaptchaModal() {
            const captchaModal = document.getElementById('captchaModal');
            captchaModal.style.display = 'none';  // Hide CAPTCHA modal
        }
        // Function to download chat log
        async function downloadChatLog() {
            localStorage.setItem('submittedData', JSON.stringify({ chatSent: "PDF" }));
            // Hide the transcript modal and background
            downloadModal.style.display = 'none';
            // Show the loading modal
            loadingModal.style.display = 'flex';
            // Get the disclaimer text
            const disclaimerText = document.getElementById('disclaimer').textContent.trim();
            setTimeout(() => {
                const messages = Array.from(document.querySelectorAll('.message-container'));
                // Exclude the initial system messages if any
                const relevantMessages = messages; // Adjust if you need to exclude any messages
                // Construct the chat log content
                let chatLog = '';
                relevantMessages.forEach(container => {
                    const message = container.querySelector('.message');
                    const sender = message.classList.contains('me') ? 'You' : 'DebtChat';
                    const text = message.textContent.trim();
                    chatLog += `${sender}: ${text}\n\n`;
                });
                // Initialize jsPDF
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                const padding = 10;
                // Add the disclaimer at the top
                doc.setFontSize(10); // Smaller font for the disclaimer
                doc.setTextColor(128, 128, 128); // Set text color to grey (RGB values)
                const pageWidth = doc.internal.pageSize.getWidth();
                doc.text(disclaimerText, pageWidth / 2, 20, { align: 'center' }); // Centered disclaimer
                // Reset text color to black for the chat content
                doc.setTextColor(0, 0, 0);
                // Add chat log starting after the disclaimer
                doc.setFontSize(12); // Reset font size for chat content
                const textLines = doc.splitTextToSize(chatLog, pageWidth - padding * 2);
                let yPosition = 35; // Start below the disclaimer
                const lineHeight = 6;
                const pageHeight = doc.internal.pageSize.height - 40;
                for (let i = 0; i < textLines.length; i++) {
                    if (yPosition + lineHeight > pageHeight) {
                        doc.addPage();
                        yPosition = padding;
                    }
                    doc.text(textLines[i], padding, yPosition);
                    yPosition += lineHeight;
                }
                // Footer and final touches
                doc.setTextColor(51, 88, 239);
                doc.setFontSize(14);
                doc.text('Powered by DebtCat', padding, doc.internal.pageSize.height - 30);
                doc.save('chat-log.pdf');
                // Hide loading modal after completion
                loadingModal.style.display = 'none';
                window.location.href = '/ty-chat'; // Redirect after download
            }, 2000); // Delay to simulate loading time
        }
        // Function to send email
        async function sendEmail() {
            const email = document.getElementById('email-address').value.trim(); // Get the email from input
            // Validate email before proceeding
            if (!validateEmail(email)) {
                console.error('Invalid email address');
                return;
            }
            // Get the disclaimer text
            const disclaimerText = document.getElementById('disclaimer').textContent.trim();
            // Save data to localStorage for future use
            localStorage.setItem('submittedData', JSON.stringify({ chatSent: "EmailMe" }));
            // Hide the transcript modal and background
            downloadModal.style.display = 'none';
            // Show the loading modal while the email is being processed
            loadingModal.style.display = 'flex';
            // Prepare timestamp, user agent, and IP for logging
            const timestamp = new Date().toISOString();
            const userAgent = navigator.userAgent;
            const ip = await getUserIP();
            // Prepare the chat log
            const messages = Array.from(document.querySelectorAll('.message-container'));
            // Construct the chat log content
            let chatLogContent = '';
            messages.forEach(container => {
                const message = container.querySelector('.message');
                const sender = message.classList.contains('me') ? 'You' : 'DebtChat';
                const text = message.textContent.trim();
                chatLogContent += `<p style="margin: 0 0 10px 0; padding: 0;"><strong>${sender}:</strong> ${text}</p>`;
            });
            // Include the disclaimer at the top
            const disclaimerHTML = `<p style="color: grey; font-size: 12px; text-align: left; margin: 0 0 10px 0; padding: 0;">${disclaimerText}</p>`;
            // Combine the disclaimer and chat content
            const emailContent = `${disclaimerHTML}${chatLogContent}`;
            // Prepare the email payload
            const emailPayload = {
                subject: 'Your DebtChat Transcript',
                to: email,
                content: emailContent, // Send the chat log content with disclaimer
                isHTML: true // Indicate that the email content is HTML
            };
            // Prepare the log payload
            const logPayload = {
                email: email,
                timestamp: timestamp,
                ip: ip,
                userAgent: userAgent
            };
            try {
                // Send email via your email service (ensure it supports HTML content)
                const emailResponse = await fetch('https://sendgrid.debtcatai.workers.dev/', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(emailPayload)
                });
                if (emailResponse.ok) {
                    // Log the email and event
                    await fetch('https://glog-cht-eml.debtcatai.workers.dev/', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(logPayload)
                    });
                    // Hide loading modal once email is successfully sent
                    loadingModal.style.display = 'none';
                    window.location.href = '/ty-chat'; // Redirect to the thank-you page
                } else {
                    // Handle failure in sending email
                    console.error('Email sending failed:', await emailResponse.text());
                    loadingModal.style.display = 'none';
                }
            } catch (error) {
                console.error('Error:', error);
                loadingModal.style.display = 'none';
            }
        }
        // Function to validate email format
        function validateEmail(email) {
            const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;  // Basic email validation pattern
            return re.test(email);
        }
        // Initial messages when page loads
        window.addEventListener('load', () => {
            setTimeout(() => {
                const loadingElement = displayLoading();
                setTimeout(() => {
                    loadingElement.remove();
                    displayMessage('debtchat', 'Hi, how can I help you today?');
                    setTimeout(() => {
                        const secondLoadingElement = displayLoading();
                        setTimeout(() => {
                            secondLoadingElement.remove();
                            displayMessage('debtchat', "Your chat is private and we don't save it, but you can grab your transcript with the download button at the bottom right ↘️");
                        }, 1000);
                    }, 1000);
                }, 2000);
            }, 500);
        });
        // Add event listeners to the email and checkbox fields
        emailInput.addEventListener('input', validateForm);
        saveEmailCheckbox.addEventListener('change', validateForm);
    });
</script>
        </body>
        </html>
      </div>
    </div>
  </div>
  <script src="https://d3e54v103j8qbb.cloudfront.net/js/jquery-3.5.1.min.dc5e7f18c8.js?site=66567a3f3727972f31237c21" type="text/javascript" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
  <script src="js/webflow.js" type="text/javascript"></script>
  <script>
    $(document).ready(function() {
      var $navbar = $('.navbar');
      $(window).scroll(function() {
        if ($(this).scrollTop() > 0) {
          $navbar.css({
            'background-color': '#3358EF',
            'transition': 'background-color 0.3s ease'
          });
        } else {
          $navbar.css('background-color', 'transparent');
        }
      });
    });
  </script>
</body>
</html>